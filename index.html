<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dani Test Software</title>

<style>
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:#f4f6f8;
}
header{
  background:#0b5ed7;
  color:white;
  padding:14px 20px;
  font-size:22px;
  font-weight:600;
}
nav{
  display:flex;
  background:#084298;
}
nav div{
  padding:14px 18px;
  color:white;
  cursor:pointer;
}
nav div.active{
  background:#0d6efd;
}
section{
  display:none;
  padding:20px;
}
section.active{
  display:block;
}
.card{
  background:white;
  padding:15px;
  margin-bottom:15px;
  border-radius:6px;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
}
button{
  padding:6px 12px;
  cursor:pointer;
}
input,select{
  padding:6px;
  width:100%;
}
.red{background:#dc3545;color:white}
.green{background:#198754;color:white}
</style>
</head>

<body>

<header>Dani Test Software</header>

<nav id="menu">
  <div onclick="openTab('invoice')" id="tab-invoice">Invoice</div>
  <div onclick="openTab('cash')" id="tab-cash">Cash In Hand</div>
  <div onclick="openTab('purchase')" id="tab-purchase">Purchase</div>
  <div onclick="openTab('products')" id="tab-products">Products</div>
  <div onclick="openTab('vendors')" id="tab-vendors">Vendor</div>
  <div onclick="openTab('reports')" id="tab-reports">Reports</div>
  <div onclick="openTab('settings')" id="tab-settings">Settings</div>
</nav>

<!-- ================= DATABASE ================= -->
<script>
const DB={
  products:JSON.parse(localStorage.getItem("products")||"[]"),
  vendors:JSON.parse(localStorage.getItem("vendors")||"[]"),
  purchases:JSON.parse(localStorage.getItem("purchases")||"[]"),
  invoices:JSON.parse(localStorage.getItem("invoices")||"[]"),
  vendorPayments:JSON.parse(localStorage.getItem("vendorPayments")||"[]"),
  cash:JSON.parse(localStorage.getItem("cash")||"[]"),
  deleted:JSON.parse(localStorage.getItem("deleted")||"[]")
};

function saveDB(){
  for(let k in DB){
    localStorage.setItem(k,JSON.stringify(DB[k]));
  }
}

function uid(p){return p+"_"+Date.now()+Math.floor(Math.random()*1000);}
</script>

<!-- ================= INVOICE ================= -->
<section id="invoice">
  <div class="card">
    <h2>Invoice</h2>
    <button class="green" onclick="addInvoiceRow()">Add Item</button>
    <table>
      <thead>
        <tr><th>Item</th><th>Qty</th><th>Rate</th><th>Total</th><th></th></tr>
      </thead>
      <tbody id="invoiceRows"></tbody>
    </table>
    <h3>Total: <span id="invTotal">0</span></h3>
    <button onclick="saveInvoice()" class="green">Save Invoice</button>
  </div>
</section>

<script>
let invoiceDraft=[];

function addInvoiceRow(){
  invoiceDraft.push({productId:"",qty:1,rate:0});
  renderInvoice();
}

function renderInvoice(){
  invoiceRows.innerHTML="";
  let total=0;

  invoiceDraft.forEach((r,i)=>{
    const p=DB.products.find(x=>x.id===r.productId)||{};
    const rowTotal=r.qty*r.rate;
    total+=rowTotal;

    invoiceRows.innerHTML+=`
      <tr>
        <td>
          <select onchange="invSetProd(${i},this.value)">
            <option></option>
            ${DB.products.map(p=>`<option value="${p.id}">${p.itemNo}</option>`).join("")}
          </select>
        </td>
        <td><input type="number" value="${r.qty}" onchange="invSetQty(${i},this.value)"></td>
        <td><input type="number" value="${r.rate}" onchange="invSetRate(${i},this.value)"></td>
        <td>${rowTotal}</td>
        <td><button class="red" onclick="invDel(${i})">X</button></td>
      </tr>
    `;
  });

  invTotal.innerText=total.toFixed(2);
}

function invSetProd(i,v){
  const p=DB.products.find(x=>x.id===v);
  invoiceDraft[i].productId=v;
  invoiceDraft[i].rate=p?p.rate:0;
  renderInvoice();
}
function invSetQty(i,v){invoiceDraft[i].qty=+v;renderInvoice();}
function invSetRate(i,v){invoiceDraft[i].rate=+v;renderInvoice();}
function invDel(i){invoiceDraft.splice(i,1);renderInvoice();}

function saveInvoice(){
  if(!invoiceDraft.length)return alert("Empty invoice");
  const total=invoiceDraft.reduce((s,r)=>s+r.qty*r.rate,0);

  DB.invoices.push({id:uid("INV"),date:new Date().toLocaleDateString(),items:invoiceDraft,total});
  DB.cash.push({id:uid("CASH"),type:"IN",amount:total,ref:"INVOICE",date:new Date().toLocaleDateString()});

  saveDB();
  invoiceDraft=[];
  renderInvoice();
  alert("Invoice saved");
}
</script>

<!-- ================= CASH ================= -->
<section id="cash">
  <div class="card">
    <h2>Cash In Hand</h2>
    <h3>Balance: <span id="cashBal"></span></h3>

    <label>From</label><input type="date" id="cashFrom">
    <label>To</label><input type="date" id="cashTo">
    <button onclick="renderCash()">Filter</button>

    <table>
      <thead>
        <tr><th>Date</th><th>Type</th><th>Amount</th><th>Ref</th><th>Balance</th></tr>
      </thead>
      <tbody id="cashRows"></tbody>
    </table>
  </div>
</section>

<script>
function cashBalance(){
  return DB.cash.reduce((s,t)=>t.type=="IN"?s+t.amount:s-t.amount,0);
}

function renderCash(){
  cashRows.innerHTML="";
  cashBal.innerText=cashBalance().toFixed(2);
  let bal=0;

  DB.cash.forEach(c=>{
    bal=c.type=="IN"?bal+c.amount:bal-c.amount;
    cashRows.innerHTML+=`
      <tr>
        <td>${c.date}</td>
        <td>${c.type}</td>
        <td>${c.amount}</td>
        <td>${c.ref}</td>
        <td>${bal.toFixed(2)}</td>
      </tr>`;
  });
}
</script>

<!-- ================= REPORTS ================= -->
<section id="reports">
  <div class="card">
    <h2>Reports</h2>
    <p>Products: ${DB.products.length}</p>
    <p>Invoices: ${DB.invoices.length}</p>
    <p>Cash: ${cashBalance()}</p>

    <h3>Deleted Records</h3>
    <pre id="deletedLog"></pre>
  </div>
</section>

<script>
function renderReports(){
  deletedLog.innerText=JSON.stringify(DB.deleted,null,2);
}
</script>

<!-- ================= SETTINGS ================= -->
<section id="settings">
  <div class="card">
    <h2>Settings</h2>
    <button onclick="localStorage.clear();location.reload()" class="red">
      Factory Reset
    </button>
  </div>
</section>

<script>
function openTab(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll("nav div").forEach(d=>d.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.getElementById("tab-"+id).classList.add("active");

  if(id==="cash")renderCash();
  if(id==="reports")renderReports();
}
openTab("invoice");
</script>

</body>
</html>
<section id="products">
  <div class="card">
    <h2>Products</h2>

    <input type="file" accept=".xlsx,.xls" onchange="uploadProductExcel(this)">
    <button onclick="exportProductsCSV()">Download CSV</button>

    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px">
      <input placeholder="Search Barcode" oninput="searchProducts()"
        id="s_barcode">
      <input placeholder="Search Item No" oninput="searchProducts()"
        id="s_item">
      <input placeholder="Search Description" oninput="searchProducts()"
        id="s_desc">
    </div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>#</th><th>Barcode</th><th>Item No</th>
          <th>Description</th><th>Rate</th><th>Stock</th>
        </tr>
      </thead>
      <tbody id="productRows"></tbody>
    </table>
    <button onclick="prevPage()">Prev</button>
    <button onclick="nextPage()">Next</button>
  </div>
</section>
let prodPage=1,prodPerPage=100,prodFiltered=[];

function renderProducts(){
  productRows.innerHTML="";
  const start=(prodPage-1)*prodPerPage;
  const page=prodFiltered.slice(start,start+prodPerPage);

  page.forEach((p,i)=>{
    productRows.innerHTML+=`
      <tr>
        <td>${start+i+1}</td>
        <td>${p.barcode||""}</td>
        <td>${p.itemNo}</td>
        <td>${p.desc}</td>
        <td>${p.rate}</td>
        <td>${p.stock||0}</td>
      </tr>`;
  });
}

function searchProducts(){
  const b=s_barcode.value.toLowerCase();
  const i=s_item.value.toLowerCase();
  const d=s_desc.value.toLowerCase();

  prodFiltered=DB.products.filter(p=>
    (!b||p.barcode?.toLowerCase().includes(b)) &&
    (!i||p.itemNo.toLowerCase().includes(i)) &&
    (!d||p.desc.toLowerCase().includes(d))
  );
  prodPage=1;
  renderProducts();
}

function nextPage(){prodPage++;renderProducts();}
function prevPage(){if(prodPage>1)prodPage--;renderProducts();}

prodFiltered=DB.products;
function uploadProductExcel(input){
  const file=input.files[0];
  const reader=new FileReader();
  reader.onload=e=>{
    const wb=XLSX.read(e.target.result,{type:"binary"});
    const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);

    rows.forEach(r=>{
      DB.products.push({
        id:uid("P"),
        barcode:r.Barcode||"",
        itemNo:r["Item No"],
        desc:r.Description,
        rate:+r["Retail Rate"]||0,
        stock:0
      });
    });

    saveDB();
    prodFiltered=DB.products;
    renderProducts();
  };
  reader.readAsBinaryString(file);
}
function exportProductsCSV(){
  let csv="Barcode,Item No,Description,Rate,Stock\n";
  DB.products.forEach(p=>{
    csv+=`${p.barcode},${p.itemNo},${p.desc},${p.rate},${p.stock}\n`;
  });
  const blob=new Blob([csv]);
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="products.csv";
  a.click();
}
<section id="purchase">
  <div class="card">
    <h2>Purchase</h2>

    <input type="file" accept=".xlsx,.xls" onchange="uploadPurchaseExcel(this)">
    <button onclick="addPurchaseRow()">Add Item</button>

    <table>
      <thead>
        <tr>
          <th>Item</th><th>Qty</th><th>Price</th><th>Total</th>
        </tr>
      </thead>
      <tbody id="purchaseRows"></tbody>
    </table>

    <h3>Total: <span id="purTotal">0</span></h3>
    <button onclick="savePurchase()" class="green">Save Purchase</button>
  </div>
</section>
let purchaseDraft=[];

function addPurchaseRow(){
  purchaseDraft.push({productId:"",qty:1,price:0});
  renderPurchase();
}

function renderPurchase(){
  purchaseRows.innerHTML="";
  let t=0;
  purchaseDraft.forEach((r,i)=>{
    const total=r.qty*r.price;
    t+=total;
    purchaseRows.innerHTML+=`
      <tr>
        <td>
          <select onchange="purSetProd(${i},this.value)">
            <option></option>
            ${DB.products.map(p=>`<option value="${p.id}">${p.itemNo}</option>`)}
          </select>
        </td>
        <td><input type="number" value="${r.qty}"
          onchange="purSetQty(${i},this.value)"></td>
        <td><input type="number" value="${r.price}"
          onchange="purSetPrice(${i},this.value)"></td>
        <td>${total}</td>
      </tr>`;
  });
  purTotal.innerText=t.toFixed(2);
}

function purSetProd(i,v){purchaseDraft[i].productId=v;}
function purSetQty(i,v){purchaseDraft[i].qty=+v;renderPurchase();}
function purSetPrice(i,v){purchaseDraft[i].price=+v;renderPurchase();}

function savePurchase(){
  const total=purchaseDraft.reduce((s,r)=>s+r.qty*r.price,0);
  DB.purchases.push({id:uid("PUR"),items:purchaseDraft,total});

  DB.cash.push({
    id:uid("CASH"),
    type:"OUT",
    amount:total,
    ref:"PURCHASE",
    date:new Date().toLocaleDateString()
  });

  purchaseDraft.forEach(r=>{
    const p=DB.products.find(x=>x.id===r.productId);
    if(p)p.stock+=r.qty;
  });

  saveDB();
  purchaseDraft=[];
  renderPurchase();
}
function uploadPurchaseExcel(input){
  const reader=new FileReader();
  reader.onload=e=>{
    const wb=XLSX.read(e.target.result,{type:"binary"});
    const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);

    rows.forEach(r=>{
      const p=DB.products.find(x=>x.itemNo==r["Item No"]);
      if(p){
        purchaseDraft.push({
          productId:p.id,
          qty:+r.Qty,
          price:+r.Price
        });
      }
    });
    renderPurchase();
  };
  reader.readAsBinaryString(input.files[0]);
}
<section id="vendors">
  <div class="card">
    <h2>Vendors</h2>
    <input id="v_name" placeholder="Vendor Name">
    <button onclick="addVendor()">Add</button>
    <ul id="vendorList"></ul>
  </div>
</section>
function addVendor(){
  DB.vendors.push({id:uid("V"),name:v_name.value});
  v_name.value="";
  saveDB();
  renderVendors();
}
function renderVendors(){
  vendorList.innerHTML="";
  DB.vendors.forEach(v=>{
    vendorList.innerHTML+=`<li>${v.name}</li>`;
  });
}
<section id="settings">
  <div class="card">
    <h2>Settings</h2>
    <label>Company Name</label>
    <input id="companyName" value="Dani Test Software">
    <button onclick="saveSettings()">Save</button>
  </div>
</section>
function saveSettings(){
  document.querySelector("header").innerText=companyName.value;
  localStorage.setItem("companyName",companyName.value);
}
document.querySelector("header").innerText=
  localStorage.getItem("companyName")||"Dani Test Software";
