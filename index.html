<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Toysplace POS</title>
<style>
body{margin:0;font-family:Arial;background:#f4f6fb}
header{background:#0b2a4a;color:#fff;padding:12px 20px;font-size:20px}
nav{background:#102f52;display:flex}
nav span{color:#cfd8e3;padding:12px 16px;cursor:pointer}
nav span.active{color:#fff;border-bottom:3px solid #fff}
section{display:none;padding:15px}
h3{margin:0 0 10px;color:#0b2a4a}
button{background:#0b2a4a;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:6px;font-size:13px}
th{background:#e9eef5}
input,select{width:100%;padding:4px}
.total{margin-top:10px;font-weight:bold}
</style>
</head>

<body>
<header>Toysplace POS</header>

<nav>
<span class="active" onclick="openTab('invoice',this)">Invoice</span>
<span onclick="openTab('purchase',this)">Purchase</span>
<span onclick="openTab('product',this)">Product</span>
<span onclick="openTab('vendor',this)">Vendor</span>
<span onclick="openTab('settings',this)">Settings</span>
</nav>

<section id="invoice"></section>
<section id="purchase"></section>
<section id="product"></section>
<section id="vendor"></section>
<section id="settings"></section>

<script>
/* ---------------- DATABASE ---------------- */
let db = JSON.parse(localStorage.getItem("tpdb")) || {
  products:[],
  vendors:[],
  invoices:[],
  purchases:[]
};
function saveDB(){localStorage.setItem("tpdb",JSON.stringify(db));}

/* ---------------- NAV ---------------- */
function openTab(id,el){
  document.querySelectorAll("nav span").forEach(x=>x.classList.remove("active"));
  el.classList.add("active");
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
  window["render_"+id]();
}
openTab("invoice",document.querySelector("nav span"));

/* ---------------- PRODUCT ---------------- */
function render_product(){
  let h=`<h3>Products</h3>
  <button onclick="productForm()">New Product</button>
  <table><tr>
  <th>#</th><th>Name</th><th>Rate</th><th>Stock</th>
  </tr>`;
  db.products.forEach((p,i)=>{
    h+=`<tr onclick="productForm(${i})">
      <td>${i+1}</td><td>${p.name}</td><td>${p.rate}</td><td>${p.stock}</td>
    </tr>`;
  });
  h+=`</table>`;
  product.innerHTML=h;
}

function productForm(i){
  let p=i!=null?db.products[i]:{name:"",rate:0,stock:0};
  product.innerHTML=`
  <h3>${i!=null?"Edit":"New"} Product</h3>
  <input id="pn" placeholder="Name" value="${p.name}"><br><br>
  <input id="pr" type="number" placeholder="Rate" value="${p.rate}"><br><br>
  <input id="ps" type="number" placeholder="Stock" value="${p.stock}"><br><br>
  <button onclick="saveProduct(${i})">Save</button>
  <button onclick="render_product()">Back</button>`;
}

function saveProduct(i){
  let p={name:pn.value,rate:+pr.value,stock:+ps.value};
  if(i!=null) db.products[i]=p; else db.products.push(p);
  saveDB(); render_product();
}

/* ---------------- VENDOR ---------------- */
function render_vendor(){
  let h=`<h3>Vendors</h3>
  <button onclick="vendorForm()">New Vendor</button>
  <table><tr>
  <th>#</th><th>Name</th><th>Balance</th><th>Last Purchase</th><th>Last Payment</th>
  </tr>`;
  db.vendors.forEach((v,i)=>{
    h+=`<tr>
      <td>${i+1}</td><td>${v.name}</td>
      <td>${v.balance}</td><td>${v.lastPurchase}</td><td>${v.lastPayment}</td>
    </tr>`;
  });
  h+=`</table>`;
  vendor.innerHTML=h;
}

function vendorForm(){
  vendor.innerHTML=`
  <h3>New Vendor</h3>
  <input id="vn" placeholder="Vendor Name"><br><br>
  <input id="vb" type="number" placeholder="Opening Balance"><br><br>
  <button onclick="saveVendor()">Save</button>
  <button onclick="render_vendor()">Back</button>`;
}

function saveVendor(){
  db.vendors.push({
    name:vn.value,
    balance:+vb.value,
    lastPurchase:0,
    lastPayment:0
  });
  saveDB(); render_vendor();
}

/* ---------------- PURCHASE ---------------- */
function render_purchase(){
  purchase.innerHTML=`<h3>Purchase</h3>
  <button onclick="newPurchase()">New Purchase</button>`;
}

function newPurchase(){
  purchase.innerHTML=`
  <h3>New Purchase</h3>
  Vendor:
  <select id="pv">${db.vendors.map(v=>`<option>${v.name}</option>`)}</select>
  <table id="pt"><tr>
  <th>Product</th><th>Qty</th><th>Rate</th><th>Amount</th>
  </tr></table>
  <button onclick="addPurchaseRow()">Add Row</button>
  <div class="total">Total: <span id="ptotal">0</span></div>
  <button onclick="savePurchase()">Save</button>
  <button onclick="render_purchase()">Back</button>`;
}

function addPurchaseRow(){
  pt.innerHTML+=`
  <tr>
    <td><select>${db.products.map(p=>`<option>${p.name}</option>`)}</select></td>
    <td><input type="number" value="1" oninput="calcPurchase()"></td>
    <td><input type="number" oninput="calcPurchase()"></td>
    <td><input readonly></td>
  </tr>`;
}

function calcPurchase(){
  let t=0;
  document.querySelectorAll("#pt tr").forEach((r,i)=>{
    if(i===0) return;
    let q=+r.cells[1].children[0].value;
    let r1=+r.cells[2].children[0].value;
    r.cells[3].children[0].value=q*r1;
    t+=q*r1;
  });
  ptotal.innerText=t;
}

function savePurchase(){
  let vendor=db.vendors.find(v=>v.name===pv.value);
  document.querySelectorAll("#pt tr").forEach((r,i)=>{
    if(i===0) return;
    let p=db.products.find(x=>x.name===r.cells[0].children[0].value);
    p.stock+=+r.cells[1].children[0].value;
  });
  vendor.lastPurchase=+ptotal.innerText;
  vendor.balance+=+ptotal.innerText;
  saveDB(); render_purchase();
}

/* ---------------- INVOICE ---------------- */
function render_invoice(){
  invoice.innerHTML=`<h3>Invoice</h3>
  <button onclick="newInvoice()">New Invoice</button>
  <table><tr>
  <th>#</th><th>Bill</th><th>Total</th>
  </tr>`;
  db.invoices.forEach((i,x)=>{
    invoice.innerHTML+=`<tr>
      <td>${x+1}</td><td>${i.bill}</td><td>${i.total}</td>
    </tr>`;
  });
  invoice.innerHTML+=`</table>`;
}

function newInvoice(){
  invoice.innerHTML=`
  <h3>New Invoice</h3>
  <table id="it"><tr>
  <th>Product</th><th>Qty</th><th>Rate</th><th>Amount</th>
  </tr></table>
  <button onclick="addInvoiceRow()">Add Row</button>
  <div class="total">Total: <span id="itotal">0</span></div>
  <button onclick="saveInvoice()">Save</button>
  <button onclick="render_invoice()">Back</button>`;
}

function addInvoiceRow(){
  it.innerHTML+=`
  <tr>
    <td><select>${db.products.filter(p=>p.stock>0).map(p=>`<option>${p.name}</option>`)}</select></td>
    <td><input type="number" value="1" oninput="calcInvoice()"></td>
    <td><input type="number" readonly></td>
    <td><input readonly></td>
  </tr>`;
}

function calcInvoice(){
  let t=0;
  document.querySelectorAll("#it tr").forEach((r,i)=>{
    if(i===0) return;
    let p=db.products.find(x=>x.name===r.cells[0].children[0].value);
    r.cells[2].children[0].value=p.rate;
    let a=p.rate*(+r.cells[1].children[0].value);
    r.cells[3].children[0].value=a;
    t+=a;
  });
  itotal.innerText=t;
}

function saveInvoice(){
  document.querySelectorAll("#it tr").forEach((r,i)=>{
    if(i===0) return;
    let p=db.products.find(x=>x.name===r.cells[0].children[0].value);
    p.stock-=+r.cells[1].children[0].value;
  });
  db.invoices.push({
    bill:"INV"+(db.invoices.length+1),
    total:+itotal.innerText
  });
  saveDB(); render_invoice();
}

/* ---------------- SETTINGS ---------------- */
function render_settings(){
  settings.innerHTML="<h3>Settings</h3><p>Configuration coming here.</p>";
}
</script>
</body>
</html>
