<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dani Test Software</title>

<!-- ====== XLSX LIBRARY ====== -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
  --primary:#0b1c2d;     /* Deep Dark Blue */
  --secondary:#ffffff;  /* White */
  --accent:#1f6feb;
  --border:#d0d7de;
}

/* ===== BODY ===== */
body{
  margin:0;
  font-family:Segoe UI, Arial;
  background:white;
  color:#0b1c2d;
}

/* ===== HEADER ===== */
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:var(--primary);
  color:white;
  padding:14px 22px;
  font-size:22px;
  font-weight:600;
}

#header-left{
  display:flex;
  align-items:center;
  gap:12px;
}

#header-logo{
  height:36px;
  width:auto;
  display:none;
}

#dateTime{
  font-size:14px;
  opacity:0.85;
}

/* ===== NAV ===== */
nav{
  display:flex;
  background:#f6f8fa;
  border-bottom:1px solid var(--border);
}

nav div{
  padding:14px 20px;
  cursor:pointer;
  transition:0.25s;
  border-bottom:3px solid transparent;
  font-weight:500;
}

nav div:hover{
  background:#eef2f7;
}

nav div.active{
  border-bottom:3px solid var(--accent);
  color:var(--accent);
  font-weight:600;
  transform:translateY(-1px);
}

/* ===== SECTION ===== */
section{
  display:none;
  padding:20px;
}

section.active{
  display:block;
  animation:fadeIn 0.25s ease-in;
}

@keyframes fadeIn{
  from{opacity:0; transform:translateY(4px);}
  to{opacity:1; transform:none;}
}

/* ===== CARD ===== */
.card{
  background:white;
  border:1px solid var(--border);
  padding:18px;
  margin-bottom:20px;
  border-radius:10px;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border:1px solid var(--border);
  padding:8px;
  text-align:center;
}

th{
  background:#f6f8fa;
  font-weight:600;
}

/* ===== INPUT ===== */
input,select{
  padding:7px;
  border-radius:6px;
  border:1px solid var(--border);
  width:100%;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}

.green{background:#2da44e;color:white;}
.red{background:#cf222e;color:white;}
.blue{background:var(--accent);color:white;}
</style>
</head>
<body>

<header>
  <div id="header-left">
    <img id="header-logo">
    <span id="softwareName">Dani Test Software</span>
  </div>
  <div id="dateTime"></div>
</header>

<nav id="menu">
  <div onclick="openTab('invoice')" id="tab-invoice">Invoice</div>
  <div onclick="openTab('cash')" id="tab-cash">Cash In Hand</div>
  <div onclick="openTab('purchase')" id="tab-purchase">Purchase</div>
  <div onclick="openTab('products')" id="tab-products">Products</div>
  <div onclick="openTab('vendors')" id="tab-vendors">Vendor</div>
  <div onclick="openTab('reports')" id="tab-reports">Reports</div>
  <div onclick="openTab('settings')" id="tab-settings">Settings</div>
</nav>

<!-- ================= DATABASE ================= -->
<script>
const DB = {
  products: JSON.parse(localStorage.getItem("products")||"[]"),
  vendors: JSON.parse(localStorage.getItem("vendors")||"[]"),
  purchases: JSON.parse(localStorage.getItem("purchases")||"[]"),
  invoices: JSON.parse(localStorage.getItem("invoices")||"[]"),
  cash: JSON.parse(localStorage.getItem("cash")||"[]"),
  deleted: JSON.parse(localStorage.getItem("deleted")||"[]")
};

function saveDB() { for(let k in DB){ localStorage.setItem(k, JSON.stringify(DB[k])); } }
function uid(prefix){ return prefix + "_" + Date.now() + Math.floor(Math.random()*1000); }
</script>

<!-- ================= INVOICE ================= -->
<section id="invoice">

<!-- ===== NEW INVOICE ===== -->
<div class="card" id="newInvoiceCard">
  <h2>New Invoice</h2>
  <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px;">
  <input id="inv_s_barcode" placeholder="Search Barcode" oninput="renderInvoice()">
  <input id="inv_s_item" placeholder="Search Item No" oninput="renderInvoice()">
  <input id="inv_s_desc" placeholder="Search Description" oninput="renderInvoice()">
</div>

  <button class="blue" onclick="addInvoiceRow()">Add Item</button>

  <table>
    <thead>
      <tr>
        <th>Barcode</th>
        <th>Item No</th>
        <th>Description</th>
        <th>Qty</th>
        <th>Rate</th>
        <th>Disc ₹</th>
        <th>Disc %</th>
        <th>Total</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="invoiceRows"></tbody>
  </table>

  <!-- ===== MAIN DISCOUNT ===== -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;">
    <input type="number" id="mainDiscAmt" placeholder="Main Discount Rs." oninput="syncMainDiscAmt()">
    <input type="number" id="mainDiscPct" placeholder="Main Discount %" oninput="syncMainDiscPct()">
  </div>

  <h3>Grand Total: Rs. <span id="invTotal">0</span></h3>

  <button class="green" onclick="saveInvoice()">Save Invoice</button>
</div>

<!-- ===== INVOICE FILTER ===== -->
<div class="card">
  <h3>Invoice History</h3>
  <input type="date" id="invDateFilter">
  <button onclick="applyInvoiceFilter()">Apply Filter</button>
</div>

<!-- ===== PREVIOUS INVOICES ===== -->
<div class="card">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Date</th>
        <th>Total</th>
        <th>Edit</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="invoiceList"></tbody>
  </table>

  <button onclick="prevInvPage()">Prev</button>
  <button onclick="nextInvPage()">Next</button>
</div>

</section>


<script>

<script>
let invoiceDraft=[];
let invPage=1, invPerPage=100;
let invFiltered=DB.invoices;
let editingInvoiceId=null;

/* ===== ADD ROW ===== */
function addInvoiceRow(){
  invoiceDraft.push({
    productId:"",
    qty:1,
    rate:0,
    discAmt:0,
    discPct:0
  });
  renderInvoice();
}

/* ===== RENDER ===== */
function renderInvoice(){
  const tbody=document.getElementById("invoiceRows");
  tbody.innerHTML="";
  let subtotal=0;

  invoiceDraft.forEach((r,i)=>{
    const p=DB.products.find(x=>x.id===r.productId)||{};
    const gross=r.qty*r.rate;
    const disc=r.discAmt || (gross*r.discPct/100);
    const total=gross-disc;
    subtotal+=total;

    tbody.innerHTML+=`
    <tr>
      <td><input placeholder="Barcode" oninput="searchInv(${i},this.value,'barcode')"></td>
      <td><input placeholder="Item No" oninput="searchInv(${i},this.value,'itemNo')"></td>
      <td><input placeholder="Description" oninput="searchInv(${i},this.value,'desc')"></td>

      <td><input type="number" value="${r.qty}" min="1" onchange="setInvQty(${i},this.value)"></td>
      <td><input type="number" value="${r.rate}" onchange="setInvRate(${i},this.value)"></td>

      <td><input type="number" value="${r.discAmt}" onchange="setInvDiscAmt(${i},this.value)"></td>
      <td><input type="number" value="${r.discPct}" onchange="setInvDiscPct(${i},this.value)"></td>

      <td>${total.toFixed(2)}</td>
      <td><button class="red" onclick="delInvRow(${i})">X</button></td>
    </tr>`;
  });

  applyMainDiscount(subtotal);
}

/* ===== SEARCH PRODUCT ===== */
function searchInv(i,val,key){
  const p=DB.products.find(x=>x[key]?.toLowerCase().includes(val.toLowerCase()));
  if(p){
    invoiceDraft[i].productId=p.id;
    invoiceDraft[i].rate=p.rate;
    renderInvoice();
  }
}

/* ===== SETTERS ===== */
function setInvQty(i,v){invoiceDraft[i].qty=+v;renderInvoice();}
function setInvRate(i,v){invoiceDraft[i].rate=+v;renderInvoice();}

function setInvDiscAmt(i,v){
  invoiceDraft[i].discAmt=+v;
  const gross=invoiceDraft[i].qty*invoiceDraft[i].rate;
  invoiceDraft[i].discPct=gross?((v/gross)*100):0;
  renderInvoice();
}

function setInvDiscPct(i,v){
  invoiceDraft[i].discPct=+v;
  const gross=invoiceDraft[i].qty*invoiceDraft[i].rate;
  invoiceDraft[i].discAmt=(gross*v/100);
  renderInvoice();
}

function delInvRow(i){invoiceDraft.splice(i,1);renderInvoice();}

/* ===== MAIN DISCOUNT ===== */
function syncMainDiscAmt(){
  const amt=+document.getElementById("mainDiscAmt").value;
  const sub=getSubTotal();
  document.getElementById("mainDiscPct").value =
    sub ? ((amt/sub)*100).toFixed(2) : 0;
  applyMainDiscount(sub);
}

function syncMainDiscPct(){
  const pct=+document.getElementById("mainDiscPct").value;
  const sub=getSubTotal();
  document.getElementById("mainDiscAmt").value =
    (sub*pct/100).toFixed(2);
  applyMainDiscount(sub);
}

function getSubTotal(){
  return invoiceDraft.reduce((s,r)=>{
    const g=r.qty*r.rate;
    return s+(g-(r.discAmt||g*r.discPct/100));
  },0);
}

function applyMainDiscount(sub){
  const disc=+document.getElementById("mainDiscAmt").value||0;
  document.getElementById("invTotal").innerText=(sub-disc).toFixed(2);
}

/* ===== SAVE INVOICE ===== */
function saveInvoice(){
  if(!invoiceDraft.length) return alert("Empty invoice");

  // restore if editing
  if(editingInvoiceId){
    const old=DB.invoices.find(i=>i.id===editingInvoiceId);
    old.items.forEach(r=>{
      const p=DB.products.find(x=>x.id===r.productId);
      if(p) p.stock+=r.qty;
    });
    DB.cash=DB.cash.filter(c=>c.ref!==editingInvoiceId);
  }

  // deduct stock
  invoiceDraft.forEach(r=>{
    const p=DB.products.find(x=>x.id===r.productId);
    if(p) p.stock-=r.qty;
  });

  const total=+document.getElementById("invTotal").innerText;

  const invId=editingInvoiceId||uid("INV");

  DB.invoices=DB.invoices.filter(i=>i.id!==invId);
  DB.invoices.push({
    id:invId,
    date:new Date().toISOString().slice(0,10),
    items:JSON.parse(JSON.stringify(invoiceDraft)),
    total
  });

  DB.cash.push({
    id:uid("CASH"),
    type:"IN",
    amount:total,
    ref:invId,
    date:new Date().toISOString().slice(0,10)
  });

  saveDB();
  invoiceDraft=[];
  editingInvoiceId=null;
  mainDiscAmt.value=mainDiscPct.value=0;
  renderInvoice();
  renderInvoiceList();
  alert("Invoice saved");
}

/* ===== INVOICE LIST ===== */
function renderInvoiceList(){
  const tbody=document.getElementById("invoiceList");
  tbody.innerHTML="";
  const start=(invPage-1)*invPerPage;
  invFiltered.slice(start,start+invPerPage).forEach((i,idx)=>{
    tbody.innerHTML+=`
    <tr>
      <td>${start+idx+1}</td>
      <td>${i.date}</td>
      <td>${i.total.toFixed(2)}</td>
      <td><button onclick="editInvoice('${i.id}')">Edit</button></td>
      <td><button class="red" onclick="deleteInvoice('${i.id}')">Delete</button></td>
    </tr>`;
  });
}

function editInvoice(id){
  const inv=DB.invoices.find(i=>i.id===id);
  editingInvoiceId=id;
  invoiceDraft=JSON.parse(JSON.stringify(inv.items));
  document.getElementById("newInvoiceCard").scrollIntoView();
  renderInvoice();
}

function deleteInvoice(id){
  if(!confirm("Delete invoice?")) return;
  const inv=DB.invoices.find(i=>i.id===id);

  inv.items.forEach(r=>{
    const p=DB.products.find(x=>x.id===r.productId);
    if(p) p.stock+=r.qty;
  });

  DB.cash=DB.cash.filter(c=>c.ref!==id);
  DB.deleted.push({type:"INVOICE",data:inv});

  DB.invoices=DB.invoices.filter(i=>i.id!==id);
  saveDB();
  renderInvoiceList();
}

/* ===== FILTER ===== */
function applyInvoiceFilter(){
  const d=document.getElementById("invDateFilter").value;
  invFiltered=d?DB.invoices.filter(i=>i.date===d):DB.invoices;
  document.getElementById("newInvoiceCard").style.display=d?"none":"block";
  invPage=1;
  renderInvoiceList();
}

function nextInvPage(){invPage++;renderInvoiceList();}
function prevInvPage(){if(invPage>1){invPage--;renderInvoiceList();}}

renderInvoiceList();
</script>


<!-- ================= CASH ================= -->
<section id="cash">
  <div class="card">
    <h2>Cash In Hand</h2>
    <h3>Balance: <span id="cashBal">0</span></h3>
    <label>From</label><input type="date" id="cashFrom">
    <label>To</label><input type="date" id="cashTo">
    <button onclick="renderCash()">Filter</button>
    <table>
      <thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Ref</th><th>Balance</th></tr></thead>
      <tbody id="cashRows"></tbody>
    </table>
  </div>
</section>
<script>
function cashBalance(){ return DB.cash.reduce((s,t)=>t.type==="IN"?s+t.amount:s-t.amount,0);}
function renderCash(){
  const tbody=document.getElementById("cashRows"); tbody.innerHTML="";
  const from=document.getElementById("cashFrom").value;
  const to=document.getElementById("cashTo").value;
  let bal=0;
  DB.cash.forEach(c=>{
    if((from && c.date<from) || (to && c.date>to)) return;
    bal=c.type==="IN"? bal+c.amount: bal-c.amount;
    tbody.innerHTML+=`<tr><td>${c.date}</td><td>${c.type}</td><td>${c.amount.toFixed(2)}</td><td>${c.ref}</td><td>${bal.toFixed(2)}</td></tr>`;
  });
  document.getElementById("cashBal").innerText=bal.toFixed(2);
}
</script>

<!-- ================= PRODUCTS ================= -->
<section id="products">
  <div class="card">
    <h2>Products</h2>
    <input type="file" accept=".xlsx,.xls" onchange="uploadProductExcel(this)">
    <button onclick="exportProductsCSV()">Download CSV</button>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px;">
      <input placeholder="Search Barcode" oninput="searchProducts()" id="s_barcode">
      <input placeholder="Search Item No" oninput="searchProducts()" id="s_item">
      <input placeholder="Search Description" oninput="searchProducts()" id="s_desc">
    </div>
  </div>
  <div class="card">
    <table>
      <thead><tr><th>#</th><th>Barcode</th><th>Item No</th><th>Description</th><th>Rate</th><th>Stock</th></tr></thead>
      <tbody id="productRows"></tbody>
    </table>
    <button onclick="prevPage()">Prev</button>
    <button onclick="nextPage()">Next</button>
  </div>
</section>
<script>
let prodPage=1, prodPerPage=100, prodFiltered=DB.products;
function renderProducts(){const tbody=document.getElementById("productRows");tbody.innerHTML="";const start=(prodPage-1)*prodPerPage;const page=prodFiltered.slice(start,start+prodPerPage);page.forEach((p,i)=>{tbody.innerHTML+=`<tr><td>${start+i+1}</td><td>${p.barcode||""}</td><td>${p.itemNo}</td><td>${p.desc}</td><td>${p.rate}</td><td>${p.stock||0}</td></tr>`;});}
function searchProducts(){const b=document.getElementById("s_barcode").value.toLowerCase();const i=document.getElementById("s_item").value.toLowerCase();const d=document.getElementById("s_desc").value.toLowerCase();prodFiltered=DB.products.filter(p=>(!b||p.barcode?.toLowerCase().includes(b))&&(!i||p.itemNo.toLowerCase().includes(i))&&(!d||p.desc.toLowerCase().includes(d)));prodPage=1;renderProducts();}
function nextPage(){prodPage++; renderProducts();}
function prevPage(){if(prodPage>1){prodPage--; renderProducts();}}
function uploadProductExcel(input){const file=input.files[0];const reader=new FileReader();reader.onload=e=>{const wb=XLSX.read(e.target.result,{type:"binary"});const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);rows.forEach(r=>{DB.products.push({id:uid("P"),barcode:r.Barcode||"",itemNo:r["Item No"]||"",desc:r.Description||"",rate:+r["Retail Rate"]||0,stock:0});}); saveDB(); prodFiltered=DB.products; renderProducts();}; reader.readAsBinaryString(file);}
function exportProductsCSV(){let csv="Barcode,Item No,Description,Rate,Stock\n";DB.products.forEach(p=>{csv+=`${p.barcode},${p.itemNo},${p.desc},${p.rate},${p.stock}\n`;}); const blob=new Blob([csv]); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="products.csv"; a.click();}
let cashPage=1, cashPerPage=100, cashFiltered=DB.cash;
let editingCashId=null;

// Populate Vendor Dropdown
function renderCashVendors(){
  const sel=document.getElementById("newPayVendor");
  sel.innerHTML='<option value="">Select Vendor</option>';
  DB.vendors.forEach(v=>sel.innerHTML+=`<option value="${v.id}">${v.name}</option>`);
}

// Render Balance Sticky Bar
function renderCashBalance(){
  const bal=DB.cash.reduce((s,t)=>t.type==="IN"?s+t.amount:s-t.amount,0);
  document.getElementById("cashBal").innerText="₨ "+bal.toFixed(2);
}

// Render Payments Table
function renderCash(){
  renderCashBalance();
  renderCashVendors();

  const from=document.getElementById("cashFrom").value;
  const to=document.getElementById("cashTo").value;

  cashFiltered=DB.cash.filter(c=>{
    if(from && c.date<from) return false;
    if(to && c.date>to) return false;
    return true;
  });

  const tbody=document.getElementById("cashRows"); tbody.innerHTML="";
  let start=(cashPage-1)*cashPerPage;
  let page=cashFiltered.slice(start,start+cashPerPage);
  let bal=0;

  page.forEach((c,i)=>{
    bal=c.type==="IN"? bal+c.amount : bal-c.amount;
    let vendorName=c.vendor ? (DB.vendors.find(v=>v.id===c.vendor)?.name||"") : "";
    tbody.innerHTML+=`
      <tr>
        <td>${start+i+1}</td>
        <td>${c.date}</td>
        <td>${vendorName}</td>
        <td>${c.type}</td>
        <td>₨ ${c.amount.toFixed(2)}</td>
        <td><button class="blue" onclick="editCash('${c.id}')">Edit</button></td>
        <td><button class="red" onclick="deleteCash('${c.id}')">Delete</button></td>
      </tr>
    `;
  });
}

// Apply Filter Button
function applyCashFilter(){
  cashPage=1;
  renderCash();
}

// Pagination
function nextCashPage(){cashPage++; renderCash();}
function prevCashPage(){if(cashPage>1){cashPage--; renderCash();}}

// New Payment
function saveNewPayment(){
  const vendor=document.getElementById("newPayVendor").value;
  const type=document.getElementById("newPayType").value;
  const amount=+document.getElementById("newPayAmount").value;
  const date=document.getElementById("newPayDate").value || new Date().toISOString().slice(0,10);

  if(amount<=0) return alert("Amount must be >0");

  if(editingCashId){
    // Editing: replace existing
    const c=DB.cash.find(c=>c.id===editingCashId);
    c.vendor=vendor; c.type=type; c.amount=amount; c.date=date;
    editingCashId=null;
  } else {
    DB.cash.push({id:uid("CASH"),vendor,type,amount,date});
  }

  saveDB();
  renderCash();
}

// Edit Payment
function editCash(id){
  const c=DB.cash.find(c=>c.id===id);
  editingCashId=id;
  document.getElementById("newPayVendor").value=c.vendor||"";
  document.getElementById("newPayType").value=c.type;
  document.getElementById("newPayAmount").value=c.amount;
  document.getElementById("newPayDate").value=c.date;
}

// Delete Payment
function deleteCash(id){
  if(!confirm("Delete payment?")) return;
  const c=DB.cash.find(c=>c.id===id);
  DB.cash=DB.cash.filter(x=>x.id!==id);
  DB.deleted.push({type:"PAYMENT",data:c});
  saveDB();
  renderCash();
}

// Initialize
renderCash();


<!-- ================= PURCHASE ================= -->
<section id="purchase">
  <div class="card">
    <h2>Purchase</h2>
    <input type="file" accept=".xlsx,.xls" onchange="uploadPurchaseExcel(this)">
    <button onclick="addPurchaseRow()">Add Item</button>
    <table>
      <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead>
      <tbody id="purchaseRows"></tbody>
    </table>
    <h3>Total: <span id="purTotal">0</span></h3>
    <button class="green" onclick="savePurchase()">Save Purchase</button>
  </div>
</section>
<script>
let purchaseDraft=[];
function addPurchaseRow(){purchaseDraft.push({productId:"",qty:1,price:0}); renderPurchase();}
function renderPurchase(){const tbody=document.getElementById("purchaseRows"); tbody.innerHTML=""; let t=0; purchaseDraft.forEach((r,i)=>{const total=r.qty*r.price; t+=total; tbody.innerHTML+=`<tr><td><select onchange="purSetProd(${i},this.value)"><option></option>${DB.products.map(p=>`<option value="${p.id}" ${p.id===r.productId?'selected':''}>${p.itemNo}</option>`).join("")}</select></td><td><input type="number" value="${r.qty}" min="1" onchange="purSetQty(${i},this.value)"></td><td><input type="number" value="${r.price}" min="0" onchange="purSetPrice(${i},this.value)"></td><td>${total.toFixed(2)}</td></tr>`;}); document.getElementById("purTotal").innerText=t.toFixed(2);}
function purSetProd(i,v){purchaseDraft[i].productId=v;}
function purSetQty(i,v){purchaseDraft[i].qty=+v; renderPurchase();}
function purSetPrice(i,v){purchaseDraft[i].price=+v; renderPurchase();}
function savePurchase(){
  const total=purchaseDraft.reduce((s,r)=>s+r.qty*r.price,0);
  DB.purchases.push({id:uid("PUR"),items:purchaseDraft,total});
  DB.cash.push({id:uid("CASH"),type:"OUT",amount:total,ref:"PURCHASE",date:new Date().toLocaleDateString()});
  purchaseDraft.forEach(r=>{const p=DB.products.find(x=>x.id===r.productId); if(p)p.stock+=r.qty;});
  saveDB(); purchaseDraft=[]; renderPurchase(); alert("Purchase saved");
}
function uploadPurchaseExcel(input){const reader=new FileReader();reader.onload=e=>{const wb=XLSX.read(e.target.result,{type:"binary"});const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);rows.forEach(r=>{const p=DB.products.find(x=>x.itemNo==r["Item No"]); if(p) purchaseDraft.push({productId:p.id,qty:+r.Qty,price:+r.Price});}); renderPurchase();}; reader.readAsBinaryString(input.files[0]);}
</script>

<!-- ================= VENDORS ================= -->
<section id="vendors">

<div class="card">
  <h2>Vendors</h2>

  <div style="display:flex;gap:10px;margin-bottom:10px;">
    <input id="v_name" placeholder="Vendor Name">
    <button class="green" onclick="addVendor()">Add Vendor</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Vendor Name</th>
        <th>Balance (₨)</th>
        <th>Edit</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="vendorRows"></tbody>
  </table>
</div>

<!-- ===== VENDOR LEDGER ===== -->
<div class="card" id="vendorLedger" style="display:none;">
  <h3 id="ledgerTitle"></h3>
  <button onclick="closeLedger()">⬅ Back</button>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Amount (₨)</th>
        <th>Ref</th>
      </tr>
    </thead>
    <tbody id="ledgerRows"></tbody>
  </table>
</div>

</section>

let editingVendorId=null;

/* ===== ADD / EDIT ===== */
function addVendor(){
  const name=document.getElementById("v_name").value.trim();
  if(!name) return alert("Enter vendor name");

  if(editingVendorId){
    const v=DB.vendors.find(v=>v.id===editingVendorId);
    v.name=name;
    editingVendorId=null;
  }else{
    DB.vendors.push({id:uid("V"),name});
  }

  document.getElementById("v_name").value="";
  saveDB();
  renderVendors();
}

/* ===== BALANCE ===== */
function vendorBalance(id){
  return DB.cash.reduce((s,c)=>{
    if(c.vendor!==id) return s;
    return c.type==="IN"? s+c.amount : s-c.amount;
  },0);
}

/* ===== LIST ===== */
function renderVendors(){
  const tbody=document.getElementById("vendorRows");
  tbody.innerHTML="";

  DB.vendors.forEach((v,i)=>{
    const bal=vendorBalance(v.id);

    tbody.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td style="color:#1f6feb;cursor:pointer"
            onclick="openLedger('${v.id}')">${v.name}</td>
        <td>${bal.toFixed(2)}</td>
        <td><button onclick="editVendor('${v.id}')">Edit</button></td>
        <td>
          <button class="red"
            ${bal!==0?'disabled':''}
            onclick="deleteVendor('${v.id}')">
            Delete
          </button>
        </td>
      </tr>`;
  });
}

/* ===== EDIT ===== */
function editVendor(id){
  const v=DB.vendors.find(v=>v.id===id);
  document.getElementById("v_name").value=v.name;
  editingVendorId=id;
}

/* ===== DELETE ===== */
function deleteVendor(id){
  if(vendorBalance(id)!==0)
    return alert("Vendor balance must be zero");

  if(!confirm("Delete vendor?")) return;

  DB.vendors=DB.vendors.filter(v=>v.id!==id);
  saveDB();
  renderVendors();
}

/* ===== LEDGER ===== */
function openLedger(id){
  const v=DB.vendors.find(v=>v.id===id);
  document.getElementById("ledgerTitle").innerText=
    "Ledger – "+v.name;

  const tbody=document.getElementById("ledgerRows");
  tbody.innerHTML="";

  DB.cash.filter(c=>c.vendor===id).forEach(c=>{
    tbody.innerHTML+=`
      <tr>
        <td>${c.date}</td>
        <td>${c.type}</td>
        <td>${c.amount.toFixed(2)}</td>
        <td>${c.ref||""}</td>
      </tr>`;
  });

  document.getElementById("vendorLedger").style.display="block";
}

/* ===== CLOSE LEDGER ===== */
function closeLedger(){
  document.getElementById("vendorLedger").style.display="none";
}

renderVendors();
</script>

<!-- ================= REPORTS ================= -->
<section id="reports">
  <div class="card">
    <h2>Reports</h2>
    <p>Products: <span id="repProducts"></span></p>
    <p>Invoices: <span id="repInvoices"></span></p>
    <p>Cash Balance: <span id="repCash"></span></p>
    <h3>Deleted Records</h3>
    <pre id="deletedLog"></pre>
  </div>
</section>
<script>
function renderReports(){document.getElementById("repProducts").innerText=DB.products.length; document.getElementById("repInvoices").innerText=DB.invoices.length; document.getElementById("repCash").innerText=cashBalance().toFixed(2); document.getElementById("deletedLog").innerText=JSON.stringify(DB.deleted,null,2);}
</script>

<!-- ================= SETTINGS ================= -->
<section id="settings">
  <div class="card">
    <h2>Settings</h2>
    <label>Company Name</label>
    <label>Software Name</label>
<input id="companyName">
    <label>Upload Logo</label>
    <input type="file" accept="image/*" onchange="uploadLogo(this)">
    <button onclick="saveSettings()" class="green">Save</button>
    <hr>
    <button onclick="if(confirm('Reset all data?')){localStorage.clear();location.reload();}" class="red">Factory Reset</button>
  </div>
</section>
<script>
function saveSettings(){const name=document.getElementById("companyName").value; document.querySelector("header").innerText=name; localStorage.setItem("companyName",name);}
const storedName=localStorage.getItem("companyName"); if(storedName) document.querySelector("header").innerText=storedName;
<script>
function saveSettings(){
  const name=document.getElementById("companyName").value;
  localStorage.setItem("softwareName",name);
  document.getElementById("softwareName").innerText=name;
  document.title=name; // TAB TITLE
}

function uploadLogo(input){
  const file=input.files[0];
  const reader=new FileReader();
  reader.onload=e=>{
    localStorage.setItem("logo",e.target.result);
    const img=document.getElementById("header-logo");
    img.src=e.target.result;
    img.style.display="block";
  };
  reader.readAsDataURL(file);
}

(function(){
  const name=localStorage.getItem("softwareName");
  if(name){
    document.getElementById("softwareName").innerText=name;
    document.title=name;
    document.getElementById("companyName").value=name;
  }

  const logo=localStorage.getItem("logo");
  if(logo){
    const img=document.getElementById("header-logo");
    img.src=logo;
    img.style.display="block";
  }
})();
</script>


<!-- ================= TAB CONTROL ================= -->
<script>
function openTab(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll("nav div").forEach(d=>d.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.getElementById("tab-"+id).classList.add("active");
  if(id==="cash") renderCash();
  if(id==="reports") renderReports();
  if(id==="products") renderProducts();
  if(id==="purchase") renderPurchase();
}
openTab("invoice");
</script>

</body>
</html>
