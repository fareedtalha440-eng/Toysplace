<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Toysplace Dani POS</title>

<style>
body{margin:0;font-family:Segoe UI;background:#f4f6fa}
header{background:#0b2d4d;color:#fff;padding:14px;font-size:22px}
nav{display:flex;gap:25px;padding:10px 20px;background:#fff;border-bottom:1px solid #ccc}
nav span{cursor:pointer;padding-bottom:6px}
nav .active{border-bottom:3px solid #0b2d4d;font-weight:600}
section{padding:15px;display:none}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
input,select{padding:6px}
button{background:#0b2d4d;color:white;border:none;padding:6px 12px;cursor:pointer}
.card{background:#e8f1ff;padding:12px;margin-top:10px}
.searchRow{display:flex;gap:10px}
.searchRow input{flex:1}
.search div{padding:4px;cursor:pointer}
.search div:hover{background:#dce8ff}
.summary{display:flex;gap:10px;margin-top:10px}
.summary div{flex:1;background:#0b2d4d;color:white;padding:10px}
</style>
</head>

<body>
<header>Toysplace Dani POS</header>

<nav>
<span class="active" onclick="openTab('invoice',this)">Invoice</span>
<span onclick="openTab('purchase',this)">Purchase</span>
<span onclick="openTab('product',this)">Product</span>
<span onclick="openTab('vendor',this)">Vendor</span>
<span onclick="openTab('reports',this)">Reports</span>
<span onclick="openTab('settings',this)">Settings</span>
</nav>

<section id="invoice"></section>
<section id="purchase"></section>
<section id="product"></section>
<section id="vendor"></section>
<section id="reports"></section>
<section id="settings"></section>

<script>
/* ---------- STORAGE ---------- */
function saveData(){
 localStorage.setItem("daniPOS",JSON.stringify({products,vendors,stock,invoices,purchases}))
}
function loadData(){
 let d=JSON.parse(localStorage.getItem("daniPOS")||"{}")
 products=d.products||[]
 vendors=d.vendors||[]
 stock=d.stock||{}
 invoices=d.invoices||[]
 purchases=d.purchases||[]
}
loadData()

/* ---------- GLOBAL ---------- */
let products=[],vendors=[],stock={},invoices=[],purchases=[]
let editingInvoice=null,editingPurchase=null

const rs=n=>"Rs. "+Number(n).toLocaleString(undefined,{minimumFractionDigits:2})

function openTab(id,el){
 document.querySelectorAll('nav span').forEach(x=>x.classList.remove('active'))
 el.classList.add('active')
 document.querySelectorAll('section').forEach(s=>s.style.display='none')
 document.getElementById(id).style.display='block'
 render()
}

/* ---------- PRODUCT ---------- */
function renderProduct(){
 let h=`<button onclick="newProduct()">New Product</button><br><br>
 <table><tr><th>S No</th><th>Barcode</th><th>Item No</th><th>Description</th><th>Rate</th><th>Stock</th><th>Edit</th></tr>`
 products.forEach((p,i)=>h+=`<tr>
 <td>${i+1}</td><td>${p.barcode}</td><td>${p.item}</td><td>${p.desc}</td>
 <td>${rs(p.rate)}</td><td>${stock[p.item]||0}</td>
 <td><button onclick="editProduct(${i})">Edit</button></td></tr>`)
 h+=`</table>`
 product.innerHTML=h
}
function newProduct(){editProduct()}
function editProduct(i){
 let p=products[i]||{}
 product.innerHTML=`
 <h3>${i!=null?"Edit":"New"} Product</h3>
 Barcode<input id=pb value="${p.barcode||""}"><br>
 Item No<input id=pi value="${p.item||""}"><br>
 Description<input id=pd value="${p.desc||""}"><br>
 Rate<input id=pr type=number value="${p.rate||""}"><br>
 Stock<input id=ps type=number value="${stock[p.item]||0}"><br><br>
 <button onclick="saveProduct(${i})">Save</button>
 <button onclick="render()">Cancel</button>`
}
function saveProduct(i){
 let item=pi.value
 products[i] ? products[i]={barcode:pb.value,item,desc:pd.value,rate:+pr.value}
 : products.push({barcode:pb.value,item,desc:pd.value,rate:+pr.value})
 stock[item]=+ps.value
 saveData();render()
}

/* ---------- VENDOR ---------- */
function renderVendor(){
 let h=`<button onclick="editVendor()">New Vendor</button><br><br>
 <table><tr><th>Name</th><th>Balance</th><th>Edit</th></tr>`
 vendors.forEach((v,i)=>h+=`<tr><td>${v.name}</td><td>${rs(v.balance)}</td>
 <td><button onclick="editVendor(${i})">Edit</button></td></tr>`)
 h+=`</table>`
 vendor.innerHTML=h
}
function editVendor(i){
 let v=vendors[i]||{}
 vendor.innerHTML=`
 Name<input id=vn value="${v.name||""}"><br>
 Balance<input id=vb type=number value="${v.balance||0}"><br><br>
 <button onclick="saveVendor(${i})">Save</button>
 <button onclick="render()">Cancel</button>`
}
function saveVendor(i){
 vendors[i]?vendors[i]={name:vn.value,balance:+vb.value}
 :vendors.push({name:vn.value,balance:+vb.value})
 saveData();render()
}

/* ---------- INVOICE ---------- */
function renderInvoice(){
 let h=`<button onclick="newInvoice()">New Invoice</button><br><br>
 <table><tr><th>Bill</th><th>Date</th><th>Items</th><th>Total</th></tr>`
 invoices.forEach((i,idx)=>{
 let t=i.items.reduce((s,x)=>s+x.qty*x.rate-x.disc,0)
 h+=`<tr onclick="editInvoice(${idx})">
 <td>${i.bill}</td><td>${i.date}</td><td>${i.items.length}</td><td>${rs(t)}</td></tr>`
 })
 h+=`</table>`
 if(editingInvoice)h+=invoiceEditor()
 invoice.innerHTML=h
}
function newInvoice(){editingInvoice={items:[]};render()}
function editInvoice(i){editingInvoice=invoices[i];render()}

function invoiceEditor(){
 let h=`<div class=card>
 <div class=searchRow>
 <input placeholder="Search product" onkeyup="invSearch(this.value)">
 </div>
 <div class=search id=invRes></div>
 <table><tr><th>Item No</th><th>Description</th><th>Qty</th><th>Rate</th><th>Disc</th><th>Amount</th></tr>`
 let amt=0,disc=0
 editingInvoice.items.forEach((x,i)=>{
 let a=x.qty*x.rate-x.disc;amt+=x.qty*x.rate;disc+=x.disc
 h+=`<tr>
 <td>${x.item}</td><td>${x.desc}</td>
 <td><input value=${x.qty} onchange="x=editingInvoice.items[${i}];x.qty=this.value;saveData();render()"></td>
 <td><input value=${x.rate} onchange="x=editingInvoice.items[${i}];x.rate=this.value;saveData();render()"></td>
 <td><input value=${x.disc} onchange="x=editingInvoice.items[${i}];x.disc=this.value;saveData();render()"></td>
 <td>${rs(a)}</td></tr>`
 })
 h+=`</table>
 <div class=summary><div>Total<br>${rs(amt-disc)}</div></div>
 <button onclick="saveInvoice()">Save Invoice</button></div>`
 return h
}
function invSearch(q){
 invRes.innerHTML=products.filter(p=>p.item.includes(q)||p.desc.toLowerCase().includes(q.toLowerCase()))
 .map(p=>`<div onclick="addInv('${p.item}')">${p.item} - ${p.desc}</div>`).join('')
}
function addInv(item){
 let p=products.find(x=>x.item===item)
 editingInvoice.items.push({item:p.item,desc:p.desc,qty:1,rate:p.rate,disc:0})
 render()
}
function saveInvoice(){
 if(!editingInvoice.bill){
 let d=new Date()
 editingInvoice.bill=1000+invoices.length
 editingInvoice.date=d.toLocaleDateString()
 invoices.push(editingInvoice)
 }
 saveData();editingInvoice=null;render()
}

/* ---------- OTHER ---------- */
function renderPurchase(){purchase.innerHTML="<h3>Purchase Editing Enabled Next</h3>"}
function renderReports(){reports.innerHTML="<h3>Reports Coming Soon</h3>"}
function renderSettings(){settings.innerHTML="<h3>Settings</h3>"}

function render(){
 renderInvoice();renderProduct();renderVendor()
 renderPurchase();renderReports();renderSettings()
}

openTab('invoice',document.querySelector('nav span'))
</script>
</body>
</html>
