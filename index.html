<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Toysplace Dani POS</title>

<style>
body{margin:0;font-family:Segoe UI;background:#f4f6fa}
header{background:#0b2d4d;color:#fff;padding:14px;font-size:22px}
nav{display:flex;gap:30px;padding:10px 20px;background:#fff;border-bottom:1px solid #ccc}
nav span{cursor:pointer;padding-bottom:6px}
nav .active{border-bottom:3px solid #0b2d4d;font-weight:600}
section{padding:15px;display:none}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
input,select{padding:6px;width:100%}
button{background:#0b2d4d;color:white;border:none;padding:7px 14px;cursor:pointer}
button:hover{opacity:.9}
.card{background:#e8f1ff;padding:12px;margin-top:10px}
.summary{display:flex;gap:15px;margin-top:12px}
.summary div{flex:1;background:#0b2d4d;color:white;padding:12px;font-size:17px}
.search div{padding:4px;cursor:pointer}
.search div:hover{background:#dce8ff}
</style>
</head>

<body>
<header>Toysplace Dani POS</header>

<nav>
<span class="active" onclick="openTab('invoice',this)">Invoice</span>
<span onclick="openTab('purchase',this)">Purchase</span>
<span onclick="openTab('product',this)">Product</span>
<span onclick="openTab('vendor',this)">Vendor</span>
<span onclick="openTab('reports',this)">Reports</span>
<span onclick="openTab('settings',this)">Settings</span>
</nav>

<section id="invoice"></section>
<section id="purchase"></section>
<section id="product"></section>
<section id="vendor"></section>
<section id="reports"></section>
<section id="settings"></section>

<script>
let products=[], vendors=[], stock={}, invoices=[], purchases=[]
let editingInvoice=null, editingPurchase=null

const rs=n=>"Rs. "+Number(n).toLocaleString(undefined,{minimumFractionDigits:2})

function openTab(id,el){
 document.querySelectorAll('nav span').forEach(x=>x.classList.remove('active'))
 el.classList.add('active')
 document.querySelectorAll('section').forEach(s=>s.style.display='none')
 document.getElementById(id).style.display='block'
 render()
}

/* ---------------- PRODUCT ---------------- */
function renderProduct(){
 let h=`<button onclick="newProduct()">New Product</button><br><br>`
 h+=`<table><tr><th>S No</th><th>Barcode</th><th>Item No</th><th>Description</th><th>Rate</th><th>Stock</th></tr>`
 products.forEach((p,i)=>h+=`<tr><td>${i+1}</td><td>${p.barcode}</td><td>${p.item}</td><td>${p.desc}</td><td>${rs(p.rate)}</td><td>${stock[p.item]||0}</td></tr>`)
 h+=`</table>`
 document.getElementById('product').innerHTML=h
}

function newProduct(){
 document.getElementById('product').innerHTML=`
 <h3>New Product</h3>
 Barcode<input id=pb><br>
 Item No<input id=pi><br>
 Description<input id=pd><br>
 Retail Rate<input id=pr type=number><br>
 Opening Stock<input id=ps type=number><br><br>
 <button onclick="saveProduct()">Save</button>
 <button onclick="render()">Cancel</button>`
}

function saveProduct(){
 if(!pb.value||!pi.value||!pd.value)return alert("Required fields")
 products.push({barcode:pb.value,item:pi.value,desc:pd.value,rate:Number(pr.value)})
 stock[pi.value]=Number(ps.value||0)
 render()
}

/* ---------------- VENDOR ---------------- */
function renderVendor(){
 let h=`<button onclick="newVendor()">New Vendor</button><br><br>`
 h+=`<table><tr><th>S No</th><th>Name</th><th>Balance</th></tr>`
 vendors.forEach((v,i)=>h+=`<tr><td>${i+1}</td><td>${v.name}</td><td>${rs(v.balance)}</td></tr>`)
 h+=`</table>`
 document.getElementById('vendor').innerHTML=h
}

function newVendor(){
 document.getElementById('vendor').innerHTML=`
 <h3>New Vendor</h3>
 Name<input id=vn><br>
 Opening Balance<input id=vb type=number><br><br>
 <button onclick="saveVendor()">Save</button>
 <button onclick="render()">Cancel</button>`
}

function saveVendor(){
 if(!vn.value)return alert("Name required")
 vendors.push({name:vn.value,balance:Number(vb.value||0)})
 render()
}

/* ---------------- SEARCH ---------------- */
function searchProduct(q){
 return products.filter(p=>p.barcode.includes(q)||p.item.includes(q)||p.desc.toLowerCase().includes(q.toLowerCase())).slice(0,6)
}

/* ---------------- INVOICE ---------------- */
function renderInvoice(){
 let h=`<button onclick="newInvoice()">New Invoice</button><br><br>`
 h+=`<table><tr><th>S No</th><th>Date</th><th>Bill</th><th>Products</th><th>Amount</th><th>Discount</th><th>Total</th><th>Time</th></tr>`
 invoices.slice(-100).forEach((i,idx)=>{
 let amt=i.items.reduce((s,x)=>s+x.qty*x.rate,0)
 let disc=i.items.reduce((s,x)=>s+x.disc,0)
 h+=`<tr><td>${idx+1}</td><td>${i.date}</td><td>${i.bill}</td><td>${i.items.length}</td><td>${rs(amt)}</td><td>${rs(disc)}</td><td>${rs(amt-disc)}</td><td>${i.time}</td></tr>`
 })
 h+=`</table>`
 if(editingInvoice)h+=invoiceEditor()
 document.getElementById('invoice').innerHTML=h
}

function newInvoice(){
 editingInvoice={items:[],disc:0}
 render()
}

function invoiceEditor(){
 let h=`<div class=card><h3>Invoice</h3>
 Barcode<input onkeyup="invSearch(this.value)">
 Item No<input onkeyup="invSearch(this.value)">
 Description<input onkeyup="invSearch(this.value)">
 <div class=search id=invRes></div>
 <table><tr><th>Description</th><th>Qty</th><th>Rate</th><th>Disc</th><th>Amount</th></tr>`
 let amt=0,disc=0
 editingInvoice.items.forEach((x,i)=>{
 let a=x.qty*x.rate-x.disc;amt+=x.qty*x.rate;disc+=x.disc
 h+=`<tr><td>${x.desc}</td><td><input value=${x.qty} onchange="x=editingInvoice.items[${i}];x.qty=this.value;render()"></td><td>${rs(x.rate)}</td><td><input value=${x.disc} onchange="x=editingInvoice.items[${i}];x.disc=this.value;render()"></td><td>${rs(a)}</td></tr>`
 })
 h+=`</table>
 <div class=summary>
 <div>Amount<br>${rs(amt)}</div>
 <div>Discount<br>${rs(disc)}</div>
 <div>Total<br>${rs(amt-disc)}</div>
 </div><br>
 <button onclick="saveInvoice()">Save</button></div>`
 return h
}

function invSearch(q){
 let r=searchProduct(q)
 let h=''
 r.forEach(p=>h+=`<div onclick="addInv('${p.item}')">${p.desc}</div>`)
 invRes.innerHTML=h
}

function addInv(item){
 let p=products.find(x=>x.item===item)
 if(stock[p.item]<=0)return alert("Out of stock")
 stock[p.item]--
 editingInvoice.items.push({desc:p.desc,qty:1,rate:p.rate,disc:0})
 render()
}

function saveInvoice(){
 let d=new Date()
 invoices.push({items:editingInvoice.items,date:d.toLocaleDateString(),time:d.toLocaleTimeString(),bill:1000+invoices.length})
 editingInvoice=null
 render()
}

/* ---------------- PURCHASE ---------------- */
function renderPurchase(){
 let h=`<button onclick="newPurchase()">New Purchase</button><br><br>`
 if(editingPurchase){
 h+=`Vendor<select id=pv>${vendors.map(v=>`<option>${v.name}</option>`).join('')}</select><br><br>
 Barcode<input onkeyup="purSearch(this.value)">
 Item No<input onkeyup="purSearch(this.value)">
 Description<input onkeyup="purSearch(this.value)">
 <div class=search id=purRes></div>
 <table><tr><th>Description</th><th>Qty</th><th>Rate</th><th>Amount</th></tr>`
 let amt=0
 editingPurchase.items.forEach((x,i)=>{
 let a=x.qty*x.rate;amt+=a
 h+=`<tr><td>${x.desc}</td><td><input value=${x.qty} onchange="x=editingPurchase.items[${i}];x.qty=this.value;render()"></td><td><input value=${x.rate} onchange="x=editingPurchase.items[${i}];x.rate=this.value;render()"></td><td>${rs(a)}</td></tr>`
 })
 h+=`</table>
 <div class=summary><div>Total<br>${rs(amt)}</div></div><br>
 <button onclick="savePurchase()">Save</button>`
 }
 document.getElementById('purchase').innerHTML=h
}

function newPurchase(){editingPurchase={items:[]};render()}

function purSearch(q){
 let r=searchProduct(q)
 let h=''
 r.forEach(p=>h+=`<div onclick="addPur('${p.item}')">${p.desc}</div>`)
 purRes.innerHTML=h
}

function addPur(item){
 let p=products.find(x=>x.item===item)
 editingPurchase.items.push({item:p.item,desc:p.desc,qty:1,rate:p.rate})
 render()
}

function savePurchase(){
 let v=vendors.find(x=>x.name===pv.value)
 let total=0
 editingPurchase.items.forEach(x=>{stock[x.item]+=Number(x.qty);total+=x.qty*x.rate})
 v.balance+=total
 purchases.push(editingPurchase)
 editingPurchase=null
 render()
}

/* ---------------- OTHER ---------------- */
function renderReports(){reports.innerHTML="<h3>Reports Coming Soon</h3>"}
function renderSettings(){settings.innerHTML="<h3>Settings</h3>"}

function render(){
 renderInvoice()
 renderPurchase()
 renderProduct()
 renderVendor()
 renderReports()
 renderSettings()
}

openTab('invoice',document.querySelector('nav span'))
</script>
</body>
</html>
