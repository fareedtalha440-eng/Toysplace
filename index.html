<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dani Software</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
body{margin:0;font-family:Segoe UI;background:#f4f6fb}
header{background:#0b2a4a;color:#fff;padding:14px;font-size:22px}
nav{display:flex;background:#143a63}
nav div{padding:14px 18px;color:#fff;cursor:pointer}
nav .active{background:#fff;color:#143a63;font-weight:600}
section{display:none;padding:20px}
section.active{display:block}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#eef2f7}
input,select,button{padding:7px;margin:4px}
button{background:#143a63;color:#fff;border:none;border-radius:5px}
.red{background:#c0392b}
.green{background:#27ae60}
</style>
</head>

<body>

<header>
<span id="appName">Dani Software</span>
<span style="float:right">Cash: <b id="cashHeader">0</b></span>
</header>

<nav>
<div id="tab-products" onclick="openTab('products')">Products</div>
<div id="tab-vendors" onclick="openTab('vendors')">Vendors</div>
<div id="tab-purchase" onclick="openTab('purchase')">Purchase</div>
<div id="tab-invoice" onclick="openTab('invoice')">Invoice</div>
<div id="tab-cash" onclick="openTab('cash')">Cash</div>
<div id="tab-settings" onclick="openTab('settings')">Settings</div>
</nav>

<script>
const DB={
 products:JSON.parse(localStorage.getItem("products")||"[]"),
 vendors:JSON.parse(localStorage.getItem("vendors")||"[]"),
 purchases:JSON.parse(localStorage.getItem("purchases")||"[]"),
 invoices:JSON.parse(localStorage.getItem("invoices")||"[]"),
 cash:JSON.parse(localStorage.getItem("cash")||"[]"),
 settings:JSON.parse(localStorage.getItem("settings")||"{}")
}
function saveDB(){for(let k in DB)localStorage.setItem(k,JSON.stringify(DB[k]));updateCash()}
function uid(p){return p+"_"+Date.now()}
function openTab(id){
 document.querySelectorAll("section").forEach(s=>s.classList.remove("active"))
 document.querySelectorAll("nav div").forEach(n=>n.classList.remove("active"))
 document.getElementById(id).classList.add("active")
 document.getElementById("tab-"+id).classList.add("active")
 if(id==="products")renderProducts()
 if(id==="vendors")renderVendors()
 if(id==="purchase")renderPurchase()
 if(id==="invoice")renderInvoiceSearch()
 if(id==="cash")renderCash()
}
function updateCash(){
 let b=0
 DB.cash.forEach(c=>b+=c.type==="IN"?c.amount:-c.amount)
 cashHeader.innerText=b
}
</script>

<!-- ================= PRODUCTS ================= -->
<section id="products">
<div class="card">
<h2>Products</h2>
<input id="p_bar" placeholder="Barcode">
<input id="p_item" placeholder="Item No">
<input id="p_desc" placeholder="Description">
<input id="p_rate" type="number" placeholder="Rate">
<button class="green" onclick="saveProduct()">Save</button>

<table>
<thead><tr><th>#</th><th>Barcode</th><th>Item</th><th>Description</th><th>Rate</th><th>Stock</th><th>Action</th></tr></thead>
<tbody id="prodRows"></tbody>
</table>
</div>
</section>

<script>
let editProd=null
function saveProduct(){
 if(!p_item.value)return alert("Item required")
 if(!editProd){
  if(DB.products.find(x=>x.itemNo===p_item.value||x.barcode===p_bar.value))
   return alert("Duplicate")
  DB.products.push({id:uid("P"),barcode:p_bar.value,itemNo:p_item.value,desc:p_desc.value,rate:+p_rate.value,stock:0})
 }else{
  let p=DB.products.find(x=>x.id===editProd)
  p.barcode=p_bar.value;p.itemNo=p_item.value;p.desc=p_desc.value;p.rate=+p_rate.value
  editProd=null
 }
 saveDB(); renderProducts()
 p_bar.value=p_item.value=p_desc.value=p_rate.value=""
}
function renderProducts(){
 prodRows.innerHTML=""
 DB.products.forEach((p,i)=>{
  prodRows.innerHTML+=`
  <tr>
  <td>${i+1}</td><td>${p.barcode}</td><td>${p.itemNo}</td><td>${p.desc}</td>
  <td>${p.rate}</td><td>${p.stock}</td>
  <td>
   <button onclick="editProduct('${p.id}')">Edit</button>
   <button class="red" onclick="delProduct('${p.id}')">Del</button>
  </td>
  </tr>`
 })
}
function editProduct(id){
 let p=DB.products.find(x=>x.id===id)
 editProd=id
 p_bar.value=p.barcode;p_item.value=p.itemNo;p_desc.value=p.desc;p_rate.value=p.rate
}
function delProduct(id){
 if(confirm("Delete?")){
  DB.products=DB.products.filter(x=>x.id!==id)
  saveDB(); renderProducts()
 }
}
</script>

<!-- ================= VENDORS ================= -->
<section id="vendors">
<div class="card">
<h2>Vendors</h2>
<input id="v_name" placeholder="Vendor Name">
<button class="green" onclick="addVendor()">Add</button>
<table>
<thead><tr><th>#</th><th>Name</th><th>Balance</th><th>Action</th></tr></thead>
<tbody id="vendRows"></tbody>
</table>
</div>
</section>

<script>
function addVendor(){
 DB.vendors.push({id:uid("V"),name:v_name.value,ledger:[]})
 saveDB(); renderVendors(); v_name.value=""
}
function renderVendors(){
 vendRows.innerHTML=""
 DB.vendors.forEach((v,i)=>{
  let b=0;v.ledger.forEach(l=>b+=l.type==="OUT"?l.amount:-l.amount)
  vendRows.innerHTML+=`
  <tr>
  <td>${i+1}</td><td>${v.name}</td><td>${b}</td>
  <td><button class="red" onclick="delVendor('${v.id}')">Del</button></td>
  </tr>`
 })
}
function delVendor(id){
 DB.vendors=DB.vendors.filter(v=>v.id!==id)
 saveDB(); renderVendors()
}
</script>

<!-- ================= PURCHASE ================= -->
<section id="purchase">
<div class="card">
<h2>Purchase</h2>
<select id="purVendor"></select>
<input id="purItem" placeholder="Item No">
<input id="purQty" type="number" placeholder="Qty">
<input id="purCost" type="number" placeholder="Cost">
<button onclick="addPur()">Add</button>

<table><thead><tr><th>Item</th><th>Qty</th><th>Cost</th><th>Total</th><th>X</th></tr></thead>
<tbody id="purRows"></tbody></table>

<button class="green" onclick="savePurchase()">Save Purchase</button>

<h3>Previous</h3>
<table>
<thead><tr><th>#</th><th>Date</th><th>Total</th><th>Action</th></tr></thead>
<tbody id="oldPur"></tbody>
</table>
</div>
</section>

<script>
let purDraft=[]
function renderPurchase(){
 purVendor.innerHTML=""
 DB.vendors.forEach(v=>purVendor.innerHTML+=`<option value="${v.id}">${v.name}</option>`)
 purRows.innerHTML=""
 purDraft.forEach((r,i)=>{
  purRows.innerHTML+=`
  <tr>
  <td>${r.item}</td><td>${r.qty}</td><td>${r.cost}</td>
  <td>${r.qty*r.cost}</td>
  <td><button onclick="purDraft.splice(${i},1);renderPurchase()">X</button></td>
  </tr>`
 })
 oldPur.innerHTML=""
 DB.purchases.forEach((p,i)=>{
  oldPur.innerHTML+=`
  <tr>
  <td>${i+1}</td><td>${p.date}</td><td>${p.total}</td>
  <td><button onclick="delPurchase(${i})">Del</button></td>
  </tr>`
 })
}
function addPur(){
 let p=DB.products.find(x=>x.itemNo===purItem.value)
 if(!p)return alert("Invalid Item")
 purDraft.push({item:p.itemNo,qty:+purQty.value,cost:+purCost.value})
 renderPurchase()
 purItem.value=purQty.value=purCost.value=""
}
function savePurchase(){
 let total=0
 purDraft.forEach(r=>{
  let p=DB.products.find(x=>x.itemNo===r.item)
  p.stock+=r.qty
  total+=r.qty*r.cost
 })
 let v=DB.vendors.find(x=>x.id===purVendor.value)
 v.ledger.push({type:"OUT",amount:total})
 DB.purchases.push({date:new Date().toLocaleDateString(),items:purDraft,total})
 purDraft=[]
 saveDB(); renderPurchase()
}
function delPurchase(i){
 DB.purchases.splice(i,1)
 saveDB(); renderPurchase()
}
</script>

<!-- ================= INVOICE ================= -->
<section id="invoice">
<div class="card">
<h2>Invoice</h2>
<input id="s_bar" placeholder="Barcode" oninput="renderInvoiceSearch()">
<input id="s_item" placeholder="Item No" oninput="renderInvoiceSearch()">
<input id="s_desc" placeholder="Description" oninput="renderInvoiceSearch()">

<table>
<thead><tr><th>Item</th><th>Stock</th><th>Rate</th><th>Add</th></tr></thead>
<tbody id="invSearch"></tbody>
</table>

<h3>Invoice</h3>
<table>
<thead><tr><th>Item</th><th>Qty</th><th>Total</th><th>X</th></tr></thead>
<tbody id="invRows"></tbody>
</table>

<h3>Total: <span id="invTotal">0</span></h3>
<button class="green" onclick="saveInvoice()">Save</button>
</div>
</section>

<script>
let invDraft=[]
function renderInvoiceSearch(){
 invSearch.innerHTML=""
 DB.products.filter(p=>p.stock>0).forEach(p=>{
  if(
   (!s_bar.value||p.barcode.includes(s_bar.value)) &&
   (!s_item.value||p.itemNo.includes(s_item.value)) &&
   (!s_desc.value||p.desc.includes(s_desc.value))
  ){
   invSearch.innerHTML+=`
   <tr>
   <td>${p.itemNo}</td><td>${p.stock}</td><td>${p.rate}</td>
   <td><button onclick="addInv('${p.id}')">+</button></td>
   </tr>`
  }
 })
}
function addInv(id){
 let p=DB.products.find(x=>x.id===id)
 let r=invDraft.find(x=>x.id===id)
 if(r)r.qty++
 else invDraft.push({id,qty:1,rate:p.rate})
 renderInv()
}
function renderInv(){
 invRows.innerHTML=""
 let t=0
 invDraft.forEach((r,i)=>{
  let p=DB.products.find(x=>x.id===r.id)
  let amt=r.qty*r.rate;t+=amt
  invRows.innerHTML+=`
  <tr>
  <td>${p.itemNo}</td>
  <td><input type="number" value="${r.qty}" onchange="rQty(${i},this.value)"></td>
  <td>${amt}</td>
  <td><button onclick="invDraft.splice(${i},1);renderInv()">X</button></td>
  </tr>`
 })
 invTotal.innerText=t
}
function rQty(i,v){invDraft[i].qty=+v;renderInv()}
function saveInvoice(){
 let t=0
 invDraft.forEach(r=>{
  let p=DB.products.find(x=>x.id===r.id)
  p.stock-=r.qty
  t+=r.qty*r.rate
 })
 DB.invoices.push({date:new Date().toLocaleDateString(),items:invDraft,total:t})
 DB.cash.push({type:"IN",amount:t})
 invDraft=[]
 saveDB(); renderInvoiceSearch(); renderInv()
}
</script>

<!-- ================= CASH ================= -->
<section id="cash">
<div class="card">
<h2>Cash</h2>
<table>
<thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Balance</th></tr></thead>
<tbody id="cashRows"></tbody>
</table>
</div>
</section>

<script>
function renderCash(){
 let b=0;cashRows.innerHTML=""
 DB.cash.forEach(c=>{
  b+=c.type==="IN"?c.amount:-c.amount
  cashRows.innerHTML+=`<tr><td>${new Date().toLocaleDateString()}</td><td>${c.type}</td><td>${c.amount}</td><td>${b}</td></tr>`
 })
 updateCash()
}
</script>

<!-- ================= SETTINGS ================= -->
<section id="settings">
<div class="card">
<h2>Settings</h2>
<input id="setName" placeholder="Software Name">
<button class="green" onclick="saveSettings()">Save</button>
</div>
</section>

<script>
function saveSettings(){
 DB.settings.name=setName.value
 saveDB()
 appName.innerText=setName.value
}
if(DB.settings.name)appName.innerText=DB.settings.name
openTab("products")
</script>

</body>
</html>
