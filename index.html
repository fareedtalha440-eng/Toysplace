<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Toysplace POS</title>
<style>
body{font-family:Arial;margin:0;background:#f4f6fa}
header{background:#0b2d4d;color:#fff;padding:12px;font-size:20px}
nav{display:flex;gap:20px;padding:10px;background:#fff}
nav span{cursor:pointer;padding-bottom:4px}
nav .active{border-bottom:3px solid #0b2d4d;font-weight:bold}
section{padding:10px}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
input,select{padding:5px}
button{padding:6px 12px;cursor:pointer}
.popup{background:#e8f1ff;box-shadow:0 0 8px #999}
</style>
</head>

<body>
<header>Toysplace POS</header>

<nav>
<span onclick="show('invoice')" class="active">Invoice</span>
<span onclick="show('purchase')">Purchase</span>
<span onclick="show('vendor')">Vendor</span>
</nav>

<section id="invoice"></section>
<section id="purchase" style="display:none"></section>
<section id="vendor" style="display:none"></section>

<script>
/* ---------- DATA ---------- */
let products=[];
let invoices=[];
let vendors=[];
let stock={};

/* ---------- NAV ---------- */
function show(id){
 document.querySelectorAll('nav span').forEach(s=>s.classList.remove('active'));
 event.target.classList.add('active');
 document.querySelectorAll('section').forEach(s=>s.style.display='none');
 document.getElementById(id).style.display='block';
 render();
}

/* ---------- UTIL ---------- */
const rs=n=>"Rs. "+n.toLocaleString(undefined,{minimumFractionDigits:2});

/* ---------- PRODUCT SEARCH ---------- */
function searchProduct(q){
 return products.filter(p=>
  p.barcode.includes(q)||p.item.includes(q)||p.desc.toLowerCase().includes(q.toLowerCase())
 ).slice(0,6);
}

/* ---------- INVOICE ---------- */
let currentInvoice=null;

function newInvoice(){
 currentInvoice={items:[],date:new Date()};
}

function addItem(code){
 let p=products.find(x=>x.barcode===code||x.item===code);
 if(!p||stock[p.item]<=0)return;
 currentInvoice.items.push({p,qty:1,disc:0});
 stock[p.item]--;
 render();
}

function saveInvoice(){
 invoices.push(currentInvoice);
 currentInvoice=null;
 render();
}

function renderInvoice(){
 let h=`<button onclick="newInvoice()">New Invoice</button><br><br>`;
 h+=`<table><tr>
 <th>S No</th><th>Date</th><th>Bill No</th><th>Products</th>
 <th>Amount</th><th>Discount</th><th>Total</th><th>Time</th></tr>`;
 invoices.slice(-100).forEach((i,idx)=>{
 let amt=i.items.reduce((s,x)=>s+x.qty*x.p.rate,0);
 let d=i.items.reduce((s,x)=>s+x.disc,0);
 h+=`<tr>
 <td>${idx+1}</td>
 <td>${i.date.toLocaleDateString()}</td>
 <td onclick="currentInvoice=invoices[${idx}]" style="cursor:pointer">${1000+idx}</td>
 <td>${i.items.length}</td>
 <td>${rs(amt)}</td>
 <td>${rs(d)} (${((d/amt)*100||0).toFixed(2)}%)</td>
 <td>${rs(amt-d)}</td>
 <td>${i.date.toLocaleTimeString()}</td></tr>`;
 });
 h+=`</table>`;

 if(currentInvoice){
 h+=`<div class="popup"><h3>Editing Invoice</h3>
 Search <input onkeyup="showSearch(this.value)">
 <div id="results"></div>
 <table><tr><th>Item</th><th>Qty</th><th>Rate</th><th>Disc</th><th>Amount</th></tr>`;
 currentInvoice.items.forEach(x=>{
 let amt=x.qty*x.p.rate-x.disc;
 h+=`<tr>
 <td>${x.p.desc}</td>
 <td><input value="${x.qty}" onchange="x=this;this.parentNode.parentNode.qty=this.value"></td>
 <td>${rs(x.p.rate)}</td>
 <td><input value="${x.disc}"></td>
 <td>${rs(amt)}</td></tr>`;
 });
 h+=`</table>
 <button onclick="saveInvoice()">Save</button></div>`;
 }

 document.getElementById("invoice").innerHTML=h;
}

function showSearch(q){
 let r=searchProduct(q);
 let h='';
 r.forEach(p=>{
 h+=`<div onclick="addItem('${p.barcode}')">${p.desc}</div>`;
 });
 document.getElementById("results").innerHTML=h;
}

/* ---------- PURCHASE ---------- */
function renderPurchase(){
 let h=`<button onclick="addPurchase()">New Purchase</button>`;
 document.getElementById("purchase").innerHTML=h;
}

function addPurchase(){
 let vendor=prompt("Vendor Name");
 if(!vendor)return;
 vendors.push({name:vendor,balance:0});
 let code=prompt("Barcode");
 let p=products.find(x=>x.barcode===code);
 if(!p){
 if(confirm("Create new product?")){
 let item=prompt("Item No");
 let desc=prompt("Description");
 let rate=parseFloat(prompt("Rate"));
 p={barcode:code,item,desc,rate};
 products.push(p);
 stock[item]=0;
 }
 }
 let qty=parseInt(prompt("Qty"));
 let rate=parseFloat(prompt("Rate"));
 let retail=confirm("Set Retail?");
 if(retail)p.rate=parseFloat(prompt("Retail Rate"));
 stock[p.item]+=qty;
 vendors.at(-1).balance+=qty*rate;
 render();
}

/* ---------- VENDOR ---------- */
function renderVendor(){
 let h=`<table><tr><th>No</th><th>Name</th><th>Balance</th></tr>`;
 vendors.forEach((v,i)=>{
 h+=`<tr><td>${i+1}</td><td>${v.name}</td><td>${rs(v.balance)}</td></tr>`;
 });
 h+=`</table>`;
 document.getElementById("vendor").innerHTML=h;
}

/* ---------- RENDER ---------- */
function render(){
 renderInvoice();
 renderPurchase();
 renderVendor();
}

render();
</script>
</body>
</html>
