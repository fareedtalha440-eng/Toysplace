<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Toysplace POS</title>

<style>
:root{
  --dark:#0b1d33;
  --dark2:#102a52;
  --border:#cfd7e6;
  --bg:#f4f6fb;
}
body{
  margin:0;
  font-family:Segoe UI, Arial;
  background:var(--bg);
}
header{
  background:var(--dark);
  color:#fff;
  padding:14px;
  font-size:20px;
  text-align:center;
}
nav{
  position:fixed;
  top:0;left:0;
  width:220px;
  height:100vh;
  background:var(--dark2);
  padding-top:60px;
}
nav div{
  color:#fff;
  padding:14px 20px;
  cursor:pointer;
}
nav div:hover, nav div.active{
  background:#163c78;
}
main{
  margin-left:220px;
  padding:20px;
}
section{
  background:#fff;
  padding:20px;
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.hidden{display:none}
button{
  background:var(--dark2);
  color:#fff;
  border:none;
  padding:6px 12px;
  border-radius:4px;
  cursor:pointer;
}
button.red{background:#9b1c1c}
button.gray{background:#64748b}
input,select{
  width:100%;
  padding:6px;
  box-sizing:border-box;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid var(--border);
  padding:6px;
  font-size:14px;
}
th{background:#eef2fb}
.card{
  border:1px solid var(--border);
  padding:12px;
  border-radius:6px;
  margin-top:10px;
}
</style>
</head>

<body>

<header>Toysplace Retail POS</header>

<nav>
  <div class="active" onclick="openModule('products')">Products</div>
  <div onclick="openModule('vendors')">Vendors</div>
  <div onclick="openModule('purchase')">Purchase</div>
  <div onclick="openModule('invoice')">Invoice</div>
  <div onclick="openModule('cash')">Cash In Hand</div>
  <div onclick="openModule('reports')">Reports</div>
</nav>

<main>

<section id="products">
<h2>Products</h2>
<button onclick="uiProductNew()">Add Product</button>
<table>
<thead>
<tr><th>#</th><th>Barcode</th><th>Item</th><th>Description</th><th>Rate</th><th>Stock</th><th></th></tr>
</thead>
<tbody id="productTable"></tbody>
</table>

<div id="productForm" class="card hidden">
<input id="p_barcode" placeholder="Barcode">
<input id="p_item" placeholder="Item No">
<input id="p_desc" placeholder="Description">
<input id="p_rate" type="number" placeholder="Rate">
<input id="p_stock" type="number" placeholder="Opening Stock">
<br><br>
<button onclick="productSave()">Save</button>
<button class="gray" onclick="uiClose()">Cancel</button>
</div>
</section>

<section id="vendors" class="hidden">
<h2>Vendors</h2>
<button onclick="uiVendorNew()">Add Vendor</button>
<table>
<thead>
<tr><th>#</th><th>Name</th><th>Balance</th><th></th></tr>
</thead>
<tbody id="vendorTable"></tbody>
</table>

<div id="vendorForm" class="card hidden">
<input id="v_name" placeholder="Vendor Name">
<input id="v_opening" type="number" placeholder="Opening Balance">
<br><br>
<button onclick="vendorSave()">Save</button>
<button class="gray" onclick="uiClose()">Cancel</button>
</div>

<div id="vendorLedger" class="card hidden">
<h3 id="vendorLedgerTitle"></h3>
<table>
<thead>
<tr><th>Date</th><th>Type</th><th>Amount</th><th>Balance</th></tr>
</thead>
<tbody id="vendorLedgerTable"></tbody>
</table>
<br>
<input id="vendorPayAmount" type="number" placeholder="Payment Amount">
<button onclick="vendorAddPayment()">Add Payment</button>
<button class="gray" onclick="uiClose()">Close</button>
</div>
</section>

<section id="purchase" class="hidden"></section>
<section id="invoice" class="hidden"></section>
<section id="cash" class="hidden"></section>
<section id="reports" class="hidden"></section>

</main>

<script>
/* ================= DATABASE ================= */
const DB = {
  products: JSON.parse(localStorage.getItem("products")||"[]"),
  vendors: JSON.parse(localStorage.getItem("vendors")||"[]"),
  purchases: JSON.parse(localStorage.getItem("purchases")||"[]"),
  invoices: JSON.parse(localStorage.getItem("invoices")||"[]"),
  vendorPayments: JSON.parse(localStorage.getItem("vendorPayments")||"[]"),
  cashTransactions: JSON.parse(localStorage.getItem("cashTransactions")||"[]")
};

function saveDB(){
  Object.keys(DB).forEach(k=>{
    localStorage.setItem(k, JSON.stringify(DB[k]));
  });
}

function uid(p){return p+"_"+Date.now()+"_"+Math.floor(Math.random()*1000);}

/* ================= NAV ================= */
function openModule(id){
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  if(id==="purchase") renderPurchaseUI();
  if(id==="invoice") renderInvoiceUI();
  if(id==="cash") renderCash();
  if(id==="reports") renderReports();
}

/* ================= PRODUCTS ================= */
function renderProducts(){
  productTable.innerHTML="";
  DB.products.filter(p=>p.itemNo).forEach((p,i)=>{
    productTable.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td>${p.barcode||""}</td>
        <td>${p.itemNo}</td>
        <td>${p.desc}</td>
        <td>${p.rate}</td>
        <td>${p.stock}</td>
        <td><button class="red" onclick="productDelete('${p.id}')">X</button></td>
      </tr>`;
  });
}
function uiProductNew(){uiClose();productForm.classList.remove("hidden");}
function productSave(){
  if(!p_item.value) return alert("Item required");
  DB.products.push({
    id:uid("P"),
    barcode:p_barcode.value,
    itemNo:p_item.value,
    desc:p_desc.value,
    rate:+p_rate.value||0,
    stock:+p_stock.value||0
  });
  saveDB();uiClose();renderProducts();
}
function productDelete(id){
  if(DB.purchases.some(p=>p.items.some(i=>i.productId===id))||
     DB.invoices.some(i=>i.items.some(x=>x.productId===id)))
    return alert("Product used");
  DB.products=DB.products.filter(p=>p.id!==id);
  saveDB();renderProducts();
}

/* ================= VENDORS ================= */
function ensureTestVendor(){
  if(!DB.vendors.some(v=>v.id==="V_TEST")){
    DB.vendors.unshift({id:"V_TEST",name:"test",opening:0});
    saveDB();
  }
}
ensureTestVendor();

function vendorBalance(id){
  let bal=DB.vendors.find(v=>v.id===id)?.opening||0;
  DB.purchases.filter(p=>p.vendorId===id).forEach(p=>bal+=p.total);
  DB.vendorPayments.filter(p=>p.vendorId===id).forEach(p=>bal-=p.amount);
  return bal;
}
function renderVendors(){
  vendorTable.innerHTML="";
  DB.vendors.forEach((v,i)=>{
    vendorTable.innerHTML+=`
    <tr>
      <td>${i+1}</td>
      <td><a href="#" onclick="openVendorLedger('${v.id}')">${v.name}</a></td>
      <td>${vendorBalance(v.id).toFixed(2)}</td>
      <td>${v.id==="V_TEST"?"":`<button class="red" onclick="vendorDelete('${v.id}')">X</button>`}</td>
    </tr>`;
  });
}
function uiVendorNew(){uiClose();vendorForm.classList.remove("hidden");}
function vendorSave(){
  if(!v_name.value) return alert("Name required");
  DB.vendors.push({id:uid("V"),name:v_name.value,opening:+v_opening.value||0});
  saveDB();uiClose();renderVendors();
}
function vendorDelete(id){
  if(id==="V_TEST") return;
  if(DB.purchases.some(p=>p.vendorId===id)) return alert("Vendor has purchases");
  DB.vendors=DB.vendors.filter(v=>v.id!==id);
  saveDB();renderVendors();
}

/* ================= CASH ENGINE ================= */
function cashBalance(){
  return DB.cashTransactions.reduce((s,t)=>t.type==="IN"?s+t.amount:s-t.amount,0);
}
function cashAdd(type,amount,ref,note){
  if(type==="OUT" && cashBalance()<amount) return alert("Insufficient Cash");
  DB.cashTransactions.push({
    id:uid("CASH"),
    date:new Date().toLocaleDateString(),
    type,amount,ref,note
  });
  saveDB();
}

/* ================= UI HELPERS ================= */
function uiClose(){
  document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));
}
renderProducts();renderVendors();
</script>
<script>
/* ================= PURCHASE ================= */
function renderPurchaseUI(){
document.getElementById("purchase").innerHTML=`
<h2>Purchase</h2>
<div class="card">
<select id="pur_vendor"></select>
<table>
<thead><tr><th>#</th><th>Product</th><th>Qty</th><th>Rate</th><th>Amt</th><th></th></tr></thead>
<tbody id="pur_items"></tbody>
</table>
<button onclick="addPurRow()">Add</button>
<h3>Total: <span id="pur_total">0</span></h3>
<button onclick="savePurchase()">Save</button>
</div>`;
fillVendorSelect();purRows=[];
}
let purRows=[];
function fillVendorSelect(){
  pur_vendor.innerHTML="";
  DB.vendors.forEach(v=>pur_vendor.innerHTML+=`<option value="${v.id}">${v.name}</option>`);
}
function addPurRow(){purRows.push({productId:"",qty:0,rate:0});renderPur();}
function renderPur(){
  pur_items.innerHTML="";
  purRows.forEach((r,i)=>{
    pur_items.innerHTML+=`
    <tr>
      <td>${i+1}</td>
      <td><select onchange="purRows[${i}].productId=this.value">${DB.products.map(p=>`<option value="${p.id}">${p.itemNo}</option>`).join("")}</select></td>
      <td><input type="number" onchange="purRows[${i}].qty=+this.value;renderPur()"></td>
      <td><input type="number" onchange="purRows[${i}].rate=+this.value;renderPur()"></td>
      <td>${(r.qty*r.rate).toFixed(2)}</td>
      <td><button class="red" onclick="purRows.splice(${i},1);renderPur()">X</button></td>
    </tr>`;
  });
  pur_total.innerText=purRows.reduce((s,r)=>s+r.qty*r.rate,0).toFixed(2);
}
function savePurchase(){
  const total=purRows.reduce((s,r)=>s+r.qty*r.rate,0);
  DB.purchases.push({id:uid("PUR"),vendorId:pur_vendor.value,date:new Date().toLocaleDateString(),items:purRows,total});
  purRows.forEach(r=>DB.products.find(p=>p.id===r.productId).stock+=r.qty);
  saveDB();renderProducts();renderVendors();alert("Saved");
}

/* ================= INVOICE ================= */
function renderInvoiceUI(){
document.getElementById("invoice").innerHTML=`
<h2>Invoice</h2>
<div class="card">
<table>
<thead><tr><th>#</th><th>Product</th><th>Qty</th><th>Rate</th><th>Amt</th><th></th></tr></thead>
<tbody id="inv_items"></tbody>
</table>
<button onclick="addInvRow()">Add</button>
<h3>Total: <span id="inv_total">0</span></h3>
<button onclick="saveInvoice()">Save</button>
</div>`;
invRows=[];
}
let invRows=[];
function addInvRow(){invRows.push({productId:"",qty:0,rate:0});renderInv();}
function renderInv(){
  inv_items.innerHTML="";
  invRows.forEach((r,i)=>{
    inv_items.innerHTML+=`
    <tr>
      <td>${i+1}</td>
      <td><select onchange="invRows[${i}].productId=this.value">${DB.products.map(p=>`<option value="${p.id}">${p.itemNo}</option>`).join("")}</select></td>
      <td><input type="number" onchange="invRows[${i}].qty=+this.value;renderInv()"></td>
      <td><input type="number" onchange="invRows[${i}].rate=+this.value;renderInv()"></td>
      <td>${(r.qty*r.rate).toFixed(2)}</td>
      <td><button class="red" onclick="invRows.splice(${i},1);renderInv()">X</button></td>
    </tr>`;
  });
  inv_total.innerText=invRows.reduce((s,r)=>s+r.qty*r.rate,0).toFixed(2);
}
function saveInvoice(){
  const total=invRows.reduce((s,r)=>s+r.qty*r.rate,0);
  invRows.forEach(r=>{
    if(DB.products.find(p=>p.id===r.productId).stock<r.qty)
      throw alert("Stock low");
  });
  DB.invoices.push({id:uid("INV"),date:new Date().toLocaleDateString(),items:invRows,total});
  invRows.forEach(r=>DB.products.find(p=>p.id===r.productId).stock-=r.qty);
  cashAdd("IN",total,"INVOICE","Sale");
  saveDB();renderProducts();alert("Invoice Saved");
}

/* ================= CASH UI ================= */
document.getElementById("cash").innerHTML=`
<h2>Cash In Hand</h2>
<div class="card"><h3>Balance: <span id="cashBal"></span></h3></div>
<div class="card">
<select id="c_type"><option value="IN">IN</option><option value="OUT">OUT</option></select>
<input id="c_amt" type="number">
<input id="c_note" placeholder="Note">
<button onclick="manualCash()">Save</button>
</div>
<div class="card">
<table>
<thead><tr><th>#</th><th>Date</th><th>Type</th><th>Amt</th><th>Note</th><th>Bal</th></tr></thead>
<tbody id="cashTable"></tbody>
</table>
</div>`;

function manualCash(){
  cashAdd(c_type.value,+c_amt.value,"MANUAL",c_note.value);
  renderCash();
}
function renderCash(){
  cashBal.innerText=cashBalance().toFixed(2);
  cashTable.innerHTML="";
  let bal=0;
  DB.cashTransactions.forEach((t,i)=>{
    bal=t.type==="IN"?bal+t.amount:bal-t.amount;
    cashTable.innerHTML+=`
    <tr><td>${i+1}</td><td>${t.date}</td><td>${t.type}</td><td>${t.amount}</td><td>${t.note}</td><td>${bal}</td></tr>`;
  });
}

/* ================= REPORTS ================= */
document.getElementById("reports").innerHTML=`
<h2>Reports</h2>
<p>Products: <b id="r_prod"></b></p>
<p>Vendors: <b id="r_vend"></b></p>
<p>Purchases: <b id="r_pur"></b></p>
<p>Invoices: <b id="r_inv"></b></p>
<p>Cash In Hand: <b id="r_cash"></b></p>`;
function renderReports(){
  r_prod.innerText=DB.products.length;
  r_vend.innerText=DB.vendors.length;
  r_pur.innerText=DB.purchases.length;
  r_inv.innerText=DB.invoices.length;
  r_cash.innerText=cashBalance().toFixed(2);
}
</script>

</body>
</html>
