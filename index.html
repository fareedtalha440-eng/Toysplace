<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dani Test Software</title>

<!-- ====== XLSX LIBRARY ====== -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
  --primary:#0b1c2d;     /* Deep Dark Blue */
  --secondary:#ffffff;  /* White */
  --accent:#1f6feb;
  --border:#d0d7de;
}

/* ===== BODY ===== */
body{
  margin:0;
  font-family:Segoe UI, Arial;
  background:white;
  color:#0b1c2d;
}

/* ===== HEADER ===== */
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:var(--primary);
  color:white;
  padding:14px 22px;
  font-size:22px;
  font-weight:600;
}

#header-left{
  display:flex;
  align-items:center;
  gap:12px;
}

#header-logo{
  height:36px;
  width:auto;
  display:none;
}

#dateTime{
  font-size:14px;
  opacity:0.85;
}

/* ===== NAV ===== */
nav{
  display:flex;
  background:#f6f8fa;
  border-bottom:1px solid var(--border);
}

nav div{
  padding:14px 20px;
  cursor:pointer;
  transition:0.25s;
  border-bottom:3px solid transparent;
  font-weight:500;
}

nav div:hover{
  background:#eef2f7;
}

nav div.active{
  border-bottom:3px solid var(--accent);
  color:var(--accent);
  font-weight:600;
  transform:translateY(-1px);
}

/* ===== SECTION ===== */
section{
  display:none;
  padding:20px;
}

section.active{
  display:block;
  animation:fadeIn 0.25s ease-in;
}

@keyframes fadeIn{
  from{opacity:0; transform:translateY(4px);}
  to{opacity:1; transform:none;}
}

/* ===== CARD ===== */
.card{
  background:white;
  border:1px solid var(--border);
  padding:18px;
  margin-bottom:20px;
  border-radius:10px;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border:1px solid var(--border);
  padding:8px;
  text-align:center;
}

th{
  background:#f6f8fa;
  font-weight:600;
}

/* ===== INPUT ===== */
input,select{
  padding:7px;
  border-radius:6px;
  border:1px solid var(--border);
  width:100%;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}

.green{background:#2da44e;color:white;}
.red{background:#cf222e;color:white;}
.blue{background:var(--accent);color:white;}
</style>
</head>
<body>

<header>
  <div id="header-left">
    <img id="header-logo">
    <span id="softwareName">Dani Test Software</span>
  </div>
  <div id="dateTime"></div>
</header>

<nav id="menu">
  <div onclick="openTab('invoice')" id="tab-invoice">Invoice</div>
  <div onclick="openTab('cash')" id="tab-cash">Cash In Hand</div>
  <div onclick="openTab('purchase')" id="tab-purchase">Purchase</div>
  <div onclick="openTab('products')" id="tab-products">Products</div>
  <div onclick="openTab('vendors')" id="tab-vendors">Vendor</div>
  <div onclick="openTab('reports')" id="tab-reports">Reports</div>
  <div onclick="openTab('settings')" id="tab-settings">Settings</div>
</nav>

<!-- ================= DATABASE ================= -->
<script>
const DB = {
  products: JSON.parse(localStorage.getItem("products")||"[]"),
  vendors: JSON.parse(localStorage.getItem("vendors")||"[]"),
  purchases: JSON.parse(localStorage.getItem("purchases")||"[]"),
  invoices: JSON.parse(localStorage.getItem("invoices")||"[]"),
  cash: JSON.parse(localStorage.getItem("cash")||"[]"),
  deleted: JSON.parse(localStorage.getItem("deleted")||"[]")
};

function saveDB() { for(let k in DB){ localStorage.setItem(k, JSON.stringify(DB[k])); } }
function uid(prefix){ return prefix + "_" + Date.now() + Math.floor(Math.random()*1000); }
</script>

<!-- ================= INVOICE ================= -->
<section id="invoice">
  <div class="card">
    <h2>Invoice</h2>
    <button class="green" onclick="addInvoiceRow()">Add Item</button>
    <table>
      <thead>
        <tr><th>Item</th><th>Qty</th><th>Rate</th><th>Total</th><th></th></tr>
      </thead>
      <tbody id="invoiceRows"></tbody>
    </table>
    <h3>Total: <span id="invTotal">0</span></h3>
    <button onclick="saveInvoice()" class="green">Save Invoice</button>
  </div>
</section>

<script>
let invoiceDraft=[];
function addInvoiceRow(){ invoiceDraft.push({productId:"",qty:1,rate:0}); renderInvoice(); }
function renderInvoice(){
  const tbody=document.getElementById("invoiceRows"); tbody.innerHTML=""; let total=0;
  invoiceDraft.forEach((r,i)=>{
    const p=DB.products.find(x=>x.id===r.productId)||{}; const rowTotal=r.qty*r.rate; total+=rowTotal;
    tbody.innerHTML+=`
      <tr>
        <td><select onchange="invSetProd(${i},this.value)">
          <option></option>
          ${DB.products.map(p=>`<option value="${p.id}" ${p.id===r.productId?'selected':''}>${p.itemNo}</option>`).join("")}
        </select></td>
        <td><input type="number" value="${r.qty}" min="1" onchange="invSetQty(${i},this.value)"></td>
        <td><input type="number" value="${r.rate}" min="0" onchange="invSetRate(${i},this.value)"></td>
        <td>${rowTotal.toFixed(2)}</td>
        <td><button class="red" onclick="invDel(${i})">X</button></td>
      </tr>`;
  });
  document.getElementById("invTotal").innerText=total.toFixed(2);
}
function invSetProd(i,v){ const p=DB.products.find(x=>x.id===v); invoiceDraft[i].productId=v; invoiceDraft[i].rate=p?p.rate:0; renderInvoice(); }
function invSetQty(i,v){invoiceDraft[i].qty=+v; renderInvoice();}
function invSetRate(i,v){invoiceDraft[i].rate=+v; renderInvoice();}
function invDel(i){invoiceDraft.splice(i,1); renderInvoice();}
function saveInvoice(){
  if(!invoiceDraft.length) return alert("Empty invoice");
  const total=invoiceDraft.reduce((s,r)=>s+r.qty*r.rate,0);
  DB.invoices.push({id:uid("INV"),date:new Date().toLocaleDateString(),items:invoiceDraft,total});
  DB.cash.push({id:uid("CASH"),type:"IN",amount:total,ref:"INVOICE",date:new Date().toLocaleDateString()});
  saveDB(); invoiceDraft=[]; renderInvoice(); alert("Invoice saved");
}
</script>

<!-- ================= CASH ================= -->
<section id="cash">
  <div class="card">
    <h2>Cash In Hand</h2>
    <h3>Balance: <span id="cashBal">0</span></h3>
    <label>From</label><input type="date" id="cashFrom">
    <label>To</label><input type="date" id="cashTo">
    <button onclick="renderCash()">Filter</button>
    <table>
      <thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Ref</th><th>Balance</th></tr></thead>
      <tbody id="cashRows"></tbody>
    </table>
  </div>
</section>
<script>
function cashBalance(){ return DB.cash.reduce((s,t)=>t.type==="IN"?s+t.amount:s-t.amount,0);}
function renderCash(){
  const tbody=document.getElementById("cashRows"); tbody.innerHTML="";
  const from=document.getElementById("cashFrom").value;
  const to=document.getElementById("cashTo").value;
  let bal=0;
  DB.cash.forEach(c=>{
    if((from && c.date<from) || (to && c.date>to)) return;
    bal=c.type==="IN"? bal+c.amount: bal-c.amount;
    tbody.innerHTML+=`<tr><td>${c.date}</td><td>${c.type}</td><td>${c.amount.toFixed(2)}</td><td>${c.ref}</td><td>${bal.toFixed(2)}</td></tr>`;
  });
  document.getElementById("cashBal").innerText=bal.toFixed(2);
}
</script>

<!-- ================= PRODUCTS ================= -->
<section id="products">
  <div class="card">
    <h2>Products</h2>
    <input type="file" accept=".xlsx,.xls" onchange="uploadProductExcel(this)">
    <button onclick="exportProductsCSV()">Download CSV</button>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px;">
      <input placeholder="Search Barcode" oninput="searchProducts()" id="s_barcode">
      <input placeholder="Search Item No" oninput="searchProducts()" id="s_item">
      <input placeholder="Search Description" oninput="searchProducts()" id="s_desc">
    </div>
  </div>
  <div class="card">
    <table>
      <thead><tr><th>#</th><th>Barcode</th><th>Item No</th><th>Description</th><th>Rate</th><th>Stock</th></tr></thead>
      <tbody id="productRows"></tbody>
    </table>
    <button onclick="prevPage()">Prev</button>
    <button onclick="nextPage()">Next</button>
  </div>
</section>
<script>
let prodPage=1, prodPerPage=100, prodFiltered=DB.products;
function renderProducts(){const tbody=document.getElementById("productRows");tbody.innerHTML="";const start=(prodPage-1)*prodPerPage;const page=prodFiltered.slice(start,start+prodPerPage);page.forEach((p,i)=>{tbody.innerHTML+=`<tr><td>${start+i+1}</td><td>${p.barcode||""}</td><td>${p.itemNo}</td><td>${p.desc}</td><td>${p.rate}</td><td>${p.stock||0}</td></tr>`;});}
function searchProducts(){const b=document.getElementById("s_barcode").value.toLowerCase();const i=document.getElementById("s_item").value.toLowerCase();const d=document.getElementById("s_desc").value.toLowerCase();prodFiltered=DB.products.filter(p=>(!b||p.barcode?.toLowerCase().includes(b))&&(!i||p.itemNo.toLowerCase().includes(i))&&(!d||p.desc.toLowerCase().includes(d)));prodPage=1;renderProducts();}
function nextPage(){prodPage++; renderProducts();}
function prevPage(){if(prodPage>1){prodPage--; renderProducts();}}
function uploadProductExcel(input){const file=input.files[0];const reader=new FileReader();reader.onload=e=>{const wb=XLSX.read(e.target.result,{type:"binary"});const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);rows.forEach(r=>{DB.products.push({id:uid("P"),barcode:r.Barcode||"",itemNo:r["Item No"]||"",desc:r.Description||"",rate:+r["Retail Rate"]||0,stock:0});}); saveDB(); prodFiltered=DB.products; renderProducts();}; reader.readAsBinaryString(file);}
function exportProductsCSV(){let csv="Barcode,Item No,Description,Rate,Stock\n";DB.products.forEach(p=>{csv+=`${p.barcode},${p.itemNo},${p.desc},${p.rate},${p.stock}\n`;}); const blob=new Blob([csv]); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="products.csv"; a.click();}
</script>

<!-- ================= PURCHASE ================= -->
<section id="purchase">
  <div class="card">
    <h2>Purchase</h2>
    <input type="file" accept=".xlsx,.xls" onchange="uploadPurchaseExcel(this)">
    <button onclick="addPurchaseRow()">Add Item</button>
    <table>
      <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead>
      <tbody id="purchaseRows"></tbody>
    </table>
    <h3>Total: <span id="purTotal">0</span></h3>
    <button class="green" onclick="savePurchase()">Save Purchase</button>
  </div>
</section>
<script>
let purchaseDraft=[];
function addPurchaseRow(){purchaseDraft.push({productId:"",qty:1,price:0}); renderPurchase();}
function renderPurchase(){const tbody=document.getElementById("purchaseRows"); tbody.innerHTML=""; let t=0; purchaseDraft.forEach((r,i)=>{const total=r.qty*r.price; t+=total; tbody.innerHTML+=`<tr><td><select onchange="purSetProd(${i},this.value)"><option></option>${DB.products.map(p=>`<option value="${p.id}" ${p.id===r.productId?'selected':''}>${p.itemNo}</option>`).join("")}</select></td><td><input type="number" value="${r.qty}" min="1" onchange="purSetQty(${i},this.value)"></td><td><input type="number" value="${r.price}" min="0" onchange="purSetPrice(${i},this.value)"></td><td>${total.toFixed(2)}</td></tr>`;}); document.getElementById("purTotal").innerText=t.toFixed(2);}
function purSetProd(i,v){purchaseDraft[i].productId=v;}
function purSetQty(i,v){purchaseDraft[i].qty=+v; renderPurchase();}
function purSetPrice(i,v){purchaseDraft[i].price=+v; renderPurchase();}
function savePurchase(){
  const total=purchaseDraft.reduce((s,r)=>s+r.qty*r.price,0);
  DB.purchases.push({id:uid("PUR"),items:purchaseDraft,total});
  DB.cash.push({id:uid("CASH"),type:"OUT",amount:total,ref:"PURCHASE",date:new Date().toLocaleDateString()});
  purchaseDraft.forEach(r=>{const p=DB.products.find(x=>x.id===r.productId); if(p)p.stock+=r.qty;});
  saveDB(); purchaseDraft=[]; renderPurchase(); alert("Purchase saved");
}
function uploadPurchaseExcel(input){const reader=new FileReader();reader.onload=e=>{const wb=XLSX.read(e.target.result,{type:"binary"});const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);rows.forEach(r=>{const p=DB.products.find(x=>x.itemNo==r["Item No"]); if(p) purchaseDraft.push({productId:p.id,qty:+r.Qty,price:+r.Price});}); renderPurchase();}; reader.readAsBinaryString(input.files[0]);}
</script>

<!-- ================= VENDORS ================= -->
<section id="vendors">
  <div class="card">
    <h2>Vendors</h2>
    <input id="v_name" placeholder="Vendor Name">
    <button onclick="addVendor()">Add</button>
    <ul id="vendorList"></ul>
  </div>
</section>
<script>
function addVendor(){const name=document.getElementById("v_name").value.trim(); if(!name) return; DB.vendors.push({id:uid("V"),name}); document.getElementById("v_name").value=""; saveDB(); renderVendors();}
function renderVendors(){const ul=document.getElementById("vendorList"); ul.innerHTML=""; DB.vendors.forEach(v=>{ul.innerHTML+=`<li>${v.name}</li>`;});}
renderVendors();
</script>

<!-- ================= REPORTS ================= -->
<section id="reports">
  <div class="card">
    <h2>Reports</h2>
    <p>Products: <span id="repProducts"></span></p>
    <p>Invoices: <span id="repInvoices"></span></p>
    <p>Cash Balance: <span id="repCash"></span></p>
    <h3>Deleted Records</h3>
    <pre id="deletedLog"></pre>
  </div>
</section>
<script>
function renderReports(){document.getElementById("repProducts").innerText=DB.products.length; document.getElementById("repInvoices").innerText=DB.invoices.length; document.getElementById("repCash").innerText=cashBalance().toFixed(2); document.getElementById("deletedLog").innerText=JSON.stringify(DB.deleted,null,2);}
</script>

<!-- ================= SETTINGS ================= -->
<section id="settings">
  <div class="card">
    <h2>Settings</h2>
    <label>Company Name</label>
    <label>Software Name</label>
<input id="companyName">
    <label>Upload Logo</label>
    <input type="file" accept="image/*" onchange="uploadLogo(this)">
    <button onclick="saveSettings()" class="green">Save</button>
    <hr>
    <button onclick="if(confirm('Reset all data?')){localStorage.clear();location.reload();}" class="red">Factory Reset</button>
  </div>
</section>
<script>
function saveSettings(){const name=document.getElementById("companyName").value; document.querySelector("header").innerText=name; localStorage.setItem("companyName",name);}
const storedName=localStorage.getItem("companyName"); if(storedName) document.querySelector("header").innerText=storedName;
<script>
function saveSettings(){
  const name=document.getElementById("companyName").value;
  localStorage.setItem("softwareName",name);
  document.getElementById("softwareName").innerText=name;
  document.title=name; // TAB TITLE
}

function uploadLogo(input){
  const file=input.files[0];
  const reader=new FileReader();
  reader.onload=e=>{
    localStorage.setItem("logo",e.target.result);
    const img=document.getElementById("header-logo");
    img.src=e.target.result;
    img.style.display="block";
  };
  reader.readAsDataURL(file);
}

(function(){
  const name=localStorage.getItem("softwareName");
  if(name){
    document.getElementById("softwareName").innerText=name;
    document.title=name;
    document.getElementById("companyName").value=name;
  }

  const logo=localStorage.getItem("logo");
  if(logo){
    const img=document.getElementById("header-logo");
    img.src=logo;
    img.style.display="block";
  }
})();
</script>


<!-- ================= TAB CONTROL ================= -->
<script>
function openTab(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll("nav div").forEach(d=>d.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.getElementById("tab-"+id).classList.add("active");
  if(id==="cash") renderCash();
  if(id==="reports") renderReports();
  if(id==="products") renderProducts();
  if(id==="purchase") renderPurchase();
}
openTab("invoice");
</script>

</body>
</html>
