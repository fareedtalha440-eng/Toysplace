<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Business Manager</title>
<style>
body{margin:0;font-family:Arial;background:#f5f6fa}
header{background:#0b2a4a;color:#fff;padding:16px;font-size:22px}
nav{display:flex;background:#143a63}
nav div{padding:14px 18px;color:#fff;cursor:pointer}
nav div.active{background:#fff;color:#143a63;font-weight:bold}
section{display:none;padding:16px}
section.active{display:block}
.card{background:#fff;padding:16px;border-radius:6px;margin-bottom:16px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
button{padding:6px 12px;margin:2px}
input,select{padding:6px;width:100%}
</style>
</head>

<body>

<header id="appTitle">Business Manager</header>

<nav id="tabs"></nav>

<div id="app"></div>

<script>
/* ================= CORE STATE ================= */

const App = {
  state: {
    products: [],
    vendors: [],
    purchases: [],
    invoices: [],
    cash: [],
    view: "products"
  },

  save(){
    localStorage.setItem("APP_DB",JSON.stringify(this.state))
  },

  load(){
    const d=localStorage.getItem("APP_DB")
    if(d) this.state=JSON.parse(d)
  },

  uid(p){
    return p+"_"+Date.now()+"_"+Math.floor(Math.random()*999)
  }
}

App.load()
</script>
<script>
/* ================= UI SYSTEM ================= */

const Tabs=[
 ["products","Products"],
 ["vendors","Vendors"],
 ["purchase","Purchase"],
 ["invoice","Invoice"],
 ["cash","Cash"],
 ["reports","Reports"],
 ["settings","Settings"]
]

function renderTabs(){
  tabs.innerHTML=""
  Tabs.forEach(t=>{
    const d=document.createElement("div")
    d.textContent=t[1]
    d.onclick=()=>openView(t[0])
    if(App.state.view===t[0])d.classList.add("active")
    tabs.appendChild(d)
  })
}

function openView(v){
  App.state.view=v
  App.save()
  render()
}

function render(){
  renderTabs()
  app.innerHTML=""
  Views[App.state.view]()
}

/* ================= PRODUCTS ================= */

Views={
products(){
app.innerHTML=`
<div class="card">
<h3>Products</h3>
<input id="pb" placeholder="Barcode">
<input id="pi" placeholder="Item No">
<input id="pd" placeholder="Description">
<input id="pr" type="number" placeholder="Rate">
<button onclick="addProduct()">Add</button>

<table>
<tr><th>Item</th><th>Rate</th><th>Stock</th><th></th></tr>
${App.state.products.map(p=>`
<tr>
<td>${p.item}</td>
<td>${p.rate}</td>
<td>${p.stock}</td>
<td>
<button onclick="editProduct('${p.id}')">Edit</button>
<button onclick="delProduct('${p.id}')">Delete</button>
</td>
</tr>`).join("")}
</table>
</div>`
},

vendors(){
app.innerHTML=`
<div class="card">
<h3>Vendors</h3>
<input id="vn" placeholder="Vendor name">
<button onclick="addVendor()">Add</button>
<table>
${App.state.vendors.map(v=>`
<tr>
<td>${v.name}</td>
<td>
<button onclick="editVendor('${v.id}')">Edit</button>
<button onclick="delVendor('${v.id}')">Delete</button>
</td>
</tr>`).join("")}
</table>
</div>`
}
}

/* ================= ACTIONS ================= */

function addProduct(){
App.state.products.push({
 id:App.uid("P"),
 barcode:pb.value,
 item:pi.value,
 desc:pd.value,
 rate:+pr.value,
 stock:0
})
App.save();render()
}

function editProduct(id){
let p=App.state.products.find(x=>x.id===id)
let r=prompt("Rate",p.rate)
if(r!==null)p.rate=+r
App.save();render()
}

function delProduct(id){
App.state.products=App.state.products.filter(x=>x.id!==id)
App.save();render()
}

function addVendor(){
App.state.vendors.push({id:App.uid("V"),name:vn.value})
App.save();render()
}

function editVendor(id){
let v=App.state.vendors.find(x=>x.id===id)
let n=prompt("Name",v.name)
if(n)v.name=n
App.save();render()
}

function delVendor(id){
App.state.vendors=App.state.vendors.filter(x=>x.id!==id)
App.save();render()
}

render()
</script>
<script>
/* ================= PURCHASE ================= */

Views.purchase=function(){
app.innerHTML=`
<div class="card">
<h3>Purchase</h3>
<select id="pv">${App.state.vendors.map(v=>`<option value="${v.id}">${v.name}</option>`)}</select>
<select id="pp">${App.state.products.map(p=>`<option value="${p.id}">${p.item}</option>`)}</select>
<input id="pq" type="number" placeholder="Qty">
<input id="pc" type="number" placeholder="Cost">
<button onclick="addPurchase()">Add</button>
</div>`
}

function addPurchase(){
let p=App.state.products.find(x=>x.id===pp.value)
p.stock+=+pq.value
App.state.purchases.push({
 id:App.uid("PUR"),
 product:p.item,
 qty:+pq.value,
 cost:+pc.value,
 date:new Date().toLocaleDateString()
})
App.save();render()
}

/* ================= INVOICE ================= */

Views.invoice=function(){
app.innerHTML=`
<div class="card">
<h3>Invoice</h3>
${App.state.products.filter(p=>p.stock>0).map(p=>`
<div>
${p.item} (${p.stock})
<input type="number" min="1" max="${p.stock}" onchange="sell('${p.id}',this.value)">
</div>`).join("")}
</div>`
}

function sell(id,q){
let p=App.state.products.find(x=>x.id===id)
p.stock-=+q
App.state.invoices.push({
 id:App.uid("INV"),
 item:p.item,
 qty:+q,
 total:p.rate*q,
 date:new Date().toLocaleDateString()
})
App.save();render()
}

/* ================= CASH ================= */

Views.cash=function(){
app.innerHTML=`
<div class="card">
<h3>Cash</h3>
<input id="ca" type="number">
<select id="ct"><option>IN</option><option>OUT</option></select>
<button onclick="addCash()">Save</button>
<table>
${App.state.cash.map(c=>`
<tr><td>${c.date}</td><td>${c.type}</td><td>${c.amount}</td></tr>
`).join("")}
</table>
</div>`
}

function addCash(){
App.state.cash.push({
 id:App.uid("C"),
 amount:+ca.value,
 type:ct.value,
 date:new Date().toLocaleDateString()
})
App.save();render()
}

/* ================= REPORTS ================= */

Views.reports=function(){
let total=App.state.invoices.reduce((s,i)=>s+i.total,0)
app.innerHTML=`<div class="card"><h3>Total Sales</h3><h2>${total}</h2></div>`
}

/* ================= SETTINGS ================= */

Views.settings=function(){
app.innerHTML=`
<div class="card">
<input id="st" placeholder="Software Name">
<button onclick="setName()">Save</button>
</div>`
}

function setName(){
appTitle.textContent=st.value
}

</script>
</body>
</html>
