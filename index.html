<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dani Test Software</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
  --blue:#0b2a4a;
  --blue2:#143a63;
  --border:#d8e0ea;
}
body{margin:0;font-family:Segoe UI;background:#fff;color:#111}
header{background:var(--blue);color:#fff;padding:16px 24px;font-size:22px;font-weight:600}
nav{display:flex;background:var(--blue2)}
nav div{padding:14px 20px;color:#fff;cursor:pointer}
nav div.active{background:#fff;color:var(--blue);font-weight:600}
section{display:none;padding:24px}
section.active{display:block}
.card{border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:16px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid var(--border);padding:8px;text-align:center}
th{background:#f4f7fb}
button{padding:7px 14px;border-radius:6px;border:1px solid var(--blue);background:var(--blue);color:#fff;cursor:pointer}
.secondary{background:#fff;color:var(--blue)}
input,select{padding:6px;border:1px solid var(--border);border-radius:4px;width:100%}
.locked{opacity:.5;pointer-events:none}
</style>
</head>

<body>

<header id="appName">Dani Test Software</header>

<nav>
<div onclick="openTab('invoice')" id="tab-invoice">Invoice</div>
<div onclick="openTab('cash')" id="tab-cash">Cash In Hand</div>
<div onclick="openTab('purchase')" id="tab-purchase">Purchase</div>
<div onclick="openTab('products')" id="tab-products">Products</div>
<div onclick="openTab('vendors')" id="tab-vendors">Vendors</div>
<div onclick="openTab('reports')" id="tab-reports">Reports</div>
<div onclick="openTab('settings')" id="tab-settings">Settings</div>
</nav>

<script>
const DB={
products:JSON.parse(localStorage.getItem("products")||"[]"),
vendors:JSON.parse(localStorage.getItem("vendors")||"[]"),
purchases:JSON.parse(localStorage.getItem("purchases")||"[]"),
invoices:JSON.parse(localStorage.getItem("invoices")||"[]"),
cash:JSON.parse(localStorage.getItem("cash")||"[]")
};
function saveDB(){Object.keys(DB).forEach(k=>localStorage.setItem(k,JSON.stringify(DB[k])));}
function uid(p){return p+"-"+Date.now()+Math.floor(Math.random()*1000);}
</script>

<!-- ================= PRODUCTS ================= -->
<section id="products">
<div class="card">
<h2>Products</h2>
<input type="file" accept=".xlsx" onchange="uploadProductExcel(this)">
<table>
<thead>
<tr><th>S No</th><th>Barcode</th><th>Item No</th><th>Description</th><th>Retail</th><th>Stock</th><th>Actions</th></tr>
</thead>
<tbody id="prodRows"></tbody>
</table>
</div>
</section>

<script>
function renderProducts(){
const tb=document.getElementById("prodRows");tb.innerHTML="";
DB.products.forEach((p,i)=>{
tb.innerHTML+=`<tr>
<td>${i+1}</td><td>${p.barcode||""}</td><td>${p.itemNo}</td><td>${p.desc}</td>
<td>${p.rate}</td><td>${p.stock}</td>
<td>
<button onclick="editProduct(${i})">Edit</button>
<button onclick="deleteProduct(${i})">Delete</button>
</td></tr>`;
});
}
function uploadProductExcel(inp){
const r=new FileReader();
r.onload=e=>{
const wb=XLSX.read(e.target.result,{type:"binary"});
const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
rows.forEach(r=>{
DB.products.push({
id:uid("P"),
barcode:r.Barcode||"",
itemNo:r["Item No"],
desc:r.Description,
rate:+r["Retail Rate"],
stock:0,
cost:0
});
});
saveDB();renderProducts();
};
r.readAsBinaryString(inp.files[0]);
}
function editProduct(i){
const p=DB.products[i];
p.desc=prompt("Description",p.desc)||p.desc;
p.rate=+prompt("Retail Rate",p.rate)||p.rate;
saveDB();renderProducts();
}
function deleteProduct(i){
if(confirm("Delete product permanently?")){
DB.products.splice(i,1);saveDB();renderProducts();
}}
</script>

<!-- ================= PURCHASE ================= -->
<section id="purchase">
<div class="card">
<h2>New Purchase</h2>
<select id="purVendor"><option value="">Select Vendor</option></select>
<input type="file" accept=".xlsx" onchange="uploadPurchaseExcel(this)">
<button onclick="addManualPurchase()">Add Item</button>

<table>
<thead><tr><th>Item</th><th>Qty</th><th>Cost</th><th>Total</th></tr></thead>
<tbody id="purRows"></tbody>
</table>

<button onclick="savePurchase()">Finalize Purchase</button>
</div>

<div class="card">
<h3>Previous Purchases</h3>
<table>
<thead><tr><th>ID</th><th>Date</th><th>Vendor</th><th>Total</th></tr></thead>
<tbody id="oldPurchases"></tbody>
</table>
</div>
</section>

<script>
let purDraft=[];
function loadVendors(){
const s=document.getElementById("purVendor");
s.innerHTML='<option value="">Select Vendor</option>';
DB.vendors.forEach(v=>s.innerHTML+=`<option value="${v.id}">${v.name}</option>`);
}
function addManualPurchase(){
purDraft.push({productId:"",qty:1,cost:0});
renderPurchase();
}
function renderPurchase(){
const tb=document.getElementById("purRows");tb.innerHTML="";
let total=0;
purDraft.forEach((r,i)=>{
const p=DB.products.find(x=>x.id===r.productId)||{};
const t=r.qty*r.cost;total+=t;
tb.innerHTML+=`<tr>
<td>
<select onchange="purDraft[${i}].productId=this.value;renderPurchase()">
<option></option>
${DB.products.map(p=>`<option value="${p.id}">${p.itemNo}</option>`)}
</select>
</td>
<td><input type="number" value="${r.qty}" onchange="purDraft[${i}].qty=+this.value;renderPurchase()"></td>
<td><input type="number" value="${r.cost}" onchange="purDraft[${i}].cost=+this.value;renderPurchase()"></td>
<td>${t.toFixed(2)}</td>
</tr>`;
});
}
function uploadPurchaseExcel(inp){
const r=new FileReader();
r.onload=e=>{
const wb=XLSX.read(e.target.result,{type:"binary"});
const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
rows.forEach(r=>{
let p=DB.products.find(x=>x.itemNo===r["Item No"]);
if(!p){
if(confirm("Create product "+r["Item No"]+"?")){
p={id:uid("P"),itemNo:r["Item No"],desc:r.Description||"",barcode:r.Barcode||"",rate:0,stock:0,cost:0};
DB.products.push(p);
}}
purDraft.push({productId:p.id,qty:+r.Qty,cost:+r.Price});
});
renderPurchase();
};
r.readAsBinaryString(inp.files[0]);
}
function savePurchase(){
const vid=document.getElementById("purVendor").value;
if(!vid||!purDraft.length) return alert("Vendor & items required");
let total=0;
purDraft.forEach(r=>{
const p=DB.products.find(x=>x.id===r.productId);
p.stock+=r.qty;
p.cost=r.cost;
total+=r.qty*r.cost;
});
DB.purchases.push({id:uid("PUR"),date:new Date().toLocaleDateString(),vendorId:vid,total});
DB.cash.push({id:uid("CASH"),type:"OUT",amount:total,ref:"VENDOR",vendorId:vid,date:new Date().toLocaleDateString()});
purDraft=[];saveDB();renderPurchase();renderProducts();renderOldPurchases();
}
function renderOldPurchases(){
const tb=document.getElementById("oldPurchases");tb.innerHTML="";
DB.purchases.forEach(p=>{
const v=DB.vendors.find(x=>x.id===p.vendorId)||{};
tb.innerHTML+=`<tr><td>${p.id}</td><td>${p.date}</td><td>${v.name||""}</td><td>${p.total}</td></tr>`;
});
}
</script>

<!-- ================= VENDORS ================= -->
<section id="vendors">
<div class="card">
<button onclick="addVendor()">Add Vendor</button>
<table>
<thead><tr><th>Name</th><th>Balance</th></tr></thead>
<tbody id="vendorRows"></tbody>
</table>
</div>

<div class="card" id="ledgerBox" style="display:none">
<h3 id="ledgerName"></h3>
<table>
<thead><tr><th>Date</th><th>Type</th><th>Amount</th></tr></thead>
<tbody id="ledgerRows"></tbody>
</table>
</div>
</section>

<script>
function renderVendors(){
const tb=document.getElementById("vendorRows");tb.innerHTML="";
DB.vendors.forEach(v=>{
const bal=DB.cash.filter(c=>c.vendorId===v.id)
.reduce((s,c)=>c.type==="OUT"?s-c.amount:s,0);
tb.innerHTML+=`<tr><td><a onclick="openLedger('${v.id}')">${v.name}</a></td><td>${bal}</td></tr>`;
});
}
function openLedger(id){
document.getElementById("ledgerBox").style.display="block";
const v=DB.vendors.find(x=>x.id===id);
document.getElementById("ledgerName").innerText=v.name;
const tb=document.getElementById("ledgerRows");tb.innerHTML="";
DB.cash.filter(c=>c.vendorId===id)
.forEach(c=>tb.innerHTML+=`<tr><td>${c.date}</td><td>${c.type}</td><td>${c.amount}</td></tr>`);
}
function addVendor(){
const n=prompt("Vendor name");
if(n){DB.vendors.push({id:uid("V"),name:n});saveDB();renderVendors();}
}
</script>

<!-- ================= REPORTS ================= -->
<section id="reports">
<div class="card">
<button onclick="productCost()">Product Cost</button>
<button onclick="dailyReport()">Daily Report</button>
<div id="reportBox"></div>
</div>
</section>

<script>
function productCost(){
let html="<table><tr><th>Item</th><th>Stock</th><th>Cost</th></tr>";
DB.products.forEach(p=>html+=`<tr><td>${p.itemNo}</td><td>${p.stock}</td><td>${p.cost}</td></tr>`);
document.getElementById("reportBox").innerHTML=html+"</table>";
}
function dailyReport(){
let sum=0;
const today=new Date().toLocaleDateString();
DB.invoices.filter(i=>i.date===today).forEach(i=>sum+=i.total);
document.getElementById("reportBox").innerHTML="Today's Sales: "+sum;
}
</script>

<!-- ================= SETTINGS ================= -->
<section id="settings">
<div class="card">
<label>Software Name</label>
<input value="Dani Test Software" oninput="document.getElementById('appName').innerText=this.value">
<div class="locked">Factory reset is permanently locked</div>
</div>
</section>

<script>
function openTab(id){
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.querySelectorAll("nav div").forEach(t=>t.classList.remove("active"));
document.getElementById(id).classList.add("active");
document.getElementById("tab-"+id).classList.add("active");
if(id==="products")renderProducts();
if(id==="purchase"){loadVendors();renderOldPurchases();}
if(id==="vendors")renderVendors();
}
openTab("invoice");
</script>

</body>
</html>
