<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Toysplace POS</title>
<style>
body{margin:0;font-family:Arial;background:#f4f6fb}
header{background:#0b2a4a;color:#fff;padding:12px;font-size:20px}
nav{background:#0b2a4a;color:#fff;display:flex}
nav span{padding:12px 18px;cursor:pointer}
nav span.active{border-bottom:3px solid #fff}
section{display:none;padding:15px}
table{width:100%;border-collapse:collapse;margin-top:8px}
th,td{border:1px solid #ccc;padding:5px;font-size:13px}
th{background:#e9eef5}
input,select{width:100%;padding:4px}
button{padding:6px 12px;margin:6px}
tfoot td{font-weight:bold}
</style>
</head>

<body>
<header>Toysplace POS</header>

<nav>
<span class="active" onclick="openTab('invoice',this)">Invoice</span>
<span onclick="openTab('purchase',this)">Purchase</span>
<span onclick="openTab('product',this)">Product</span>
<span onclick="openTab('vendor',this)">Vendor</span>
</nav>

<section id="invoice"></section>
<section id="purchase"></section>
<section id="product"></section>
<section id="vendor"></section>

<script>
/* ---------- DATABASE ---------- */
let db = JSON.parse(localStorage.getItem("tpdb")) || {
  products: [],
  vendors: [],
  invoices: [],
  purchases: []
};
function saveDB(){ localStorage.setItem("tpdb", JSON.stringify(db)); }

/* ---------- NAV ---------- */
function openTab(id,el){
  document.querySelectorAll("nav span").forEach(x=>x.classList.remove("active"));
  el.classList.add("active");
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
  if(id==="invoice")invoiceList();
  if(id==="purchase")purchaseList();
  if(id==="product")productList();
  if(id==="vendor")vendorList();
}
openTab("invoice",document.querySelector("nav span"));

/* ---------- INVOICE ---------- */
function invoiceList(){
  let h=`<button onclick="newInvoice()">New Invoice</button>
  <table><tr>
  <th>#</th><th>Bill</th><th>Items</th><th>Total</th>
  </tr>`;
  db.invoices.forEach((i,x)=>{
    h+=`<tr onclick="editInvoice(${x})">
    <td>${x+1}</td><td>${i.bill}</td>
    <td>${i.items.length}</td><td>${i.total}</td></tr>`;
  });
  h+=`</table>`;
  invoice.innerHTML=h;
}

function newInvoice(){
  editInvoice(null);
}

function editInvoice(index){
  let inv = index!=null ? db.invoices[index] : {
    bill:"INV"+(db.invoices.length+1),
    items:[],
    total:0
  };
  let h=`<h3>Invoice ${inv.bill}</h3>
  <table id="invTable">
  <tr><th>Product</th><th>Qty</th><th>Rate</th><th>Amount</th></tr>`;
  inv.items.forEach(r=>{
    h+=rowHTML(r.product,r.qty,r.rate);
  });
  h+=rowHTML("","1","0");
  h+=`</table>
  <br>Total: <input id="invTotal" readonly>
  <br>
  <button onclick="saveInvoice(${index})">Save</button>
  <button onclick="invoiceList()">Back</button>`;
  invoice.innerHTML=h;
  calcInvoice();
}

function rowHTML(p,q,r){
  return `<tr>
  <td><select onchange="fillRate(this)">
    <option></option>
    ${db.products.map(x=>`<option value="${x.name}">${x.name}</option>`)}
  </select></td>
  <td><input type="number" value="${q}" oninput="calcInvoice()"></td>
  <td><input type="number" value="${r}" readonly></td>
  <td><input readonly></td>
  </tr>`;
}

function fillRate(sel){
  let prod=db.products.find(p=>p.name===sel.value);
  let row=sel.parentNode.parentNode;
  if(prod) row.cells[2].children[0].value=prod.rate;
  calcInvoice();
}

function calcInvoice(){
  let t=0;
  document.querySelectorAll("#invTable tr").forEach((r,i)=>{
    if(i===0) return;
    let q=+r.cells[1].children[0].value||0;
    let rate=+r.cells[2].children[0].value||0;
    let a=q*rate;
    r.cells[3].children[0].value=a;
    t+=a;
  });
  invTotal.value=t;
}

function saveInvoice(idx){
  let items=[];
  document.querySelectorAll("#invTable tr").forEach((r,i)=>{
    if(i===0) return;
    let p=r.cells[0].children[0].value;
    if(!p) return;
    items.push({
      product:p,
      qty:+r.cells[1].children[0].value,
      rate:+r.cells[2].children[0].value
    });
  });
  let inv={
    bill: idx!=null?db.invoices[idx].bill:"INV"+(db.invoices.length+1),
    items,
    total:+invTotal.value
  };
  if(idx!=null) db.invoices[idx]=inv;
  else db.invoices.push(inv);
  saveDB(); invoiceList();
}

/* ---------- PURCHASE ---------- */
function purchaseList(){
  let h=`<button onclick="newPurchase()">New Purchase</button>
  <table><tr><th>#</th><th>Vendor</th><th>Total</th></tr>`;
  db.purchases.forEach((p,i)=>{
    h+=`<tr><td>${i+1}</td><td>${p.vendor}</td><td>${p.total}</td></tr>`;
  });
  h+=`</table>`;
  purchase.innerHTML=h;
}

function newPurchase(){
  let h=`Vendor:
  <select id="pVendor">
  ${db.vendors.map(v=>`<option>${v.name}</option>`)}
  </select>
  <table id="purTable">
  <tr><th>Product</th><th>Qty</th><th>Rate</th><th>Amount</th></tr>
  </table>
  <button onclick="savePurchase()">Save</button>
  <button onclick="purchaseList()">Back</button>`;
  purchase.innerHTML=h;
}

/* ---------- PRODUCT ---------- */
function productList(){
  let h=`<button onclick="addProduct()">Add Product</button>
  <table><tr><th>#</th><th>Name</th><th>Rate</th></tr>`;
  db.products.forEach((p,i)=>{
    h+=`<tr><td>${i+1}</td><td>${p.name}</td><td>${p.rate}</td></tr>`;
  });
  h+=`</table>`;
  product.innerHTML=h;
}
function addProduct(){
  let n=prompt("Product Name");
  let r=+prompt("Rate");
  if(!n) return;
  db.products.push({name:n,rate:r});
  saveDB(); productList();
}

/* ---------- VENDOR ---------- */
function vendorList(){
  let h=`<button onclick="addVendor()">Add Vendor</button>
  <table><tr><th>#</th><th>Name</th></tr>`;
  db.vendors.forEach((v,i)=>{
    h+=`<tr><td>${i+1}</td><td>${v.name}</td></tr>`;
  });
  h+=`</table>`;
  vendor.innerHTML=h;
}
function addVendor(){
  let n=prompt("Vendor Name");
  if(!n) return;
  db.vendors.push({name:n});
  saveDB(); vendorList();
}
</script>
</body>
</html>
