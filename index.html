<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Toysplace POS</title>

<style>
body{margin:0;font-family:Segoe UI;background:#f4f6fb}
header{background:#0b2a4a;color:#fff;padding:12px 20px;font-size:20px}
nav{background:#102f52;display:flex}
nav span{
  color:#cfd8e3;
  padding:12px 18px;
  cursor:pointer;
  font-size:14px
}
nav span.active{
  color:#fff;
  border-bottom:3px solid #fff
}
section{display:none;padding:15px}
h3{margin-top:0;color:#0b2a4a}

button{
  background:#0b2a4a;
  color:#fff;
  border:none;
  padding:6px 14px;
  border-radius:4px;
  cursor:pointer
}
button.secondary{
  background:#ccc;
  color:#000
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:8px;
  background:#fff
}
th,td{
  border:1px solid #d0d6df;
  padding:6px;
  font-size:13px
}
th{background:#e9eef5}

input,select{
  width:100%;
  padding:4px;
  font-size:13px
}

.flex{display:flex;gap:8px}
.right{text-align:right}
.total-box{
  background:#eef3fa;
  padding:10px;
  margin-top:10px;
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px
}
.total-box div{font-size:14px}
.total-box input{font-weight:bold;text-align:right}
</style>
</head>

<body>
<header>Toysplace POS</header>

<nav>
<span class="active" onclick="openTab('invoice',this)">Invoice</span>
<span onclick="openTab('purchase',this)">Purchase</span>
<span onclick="openTab('product',this)">Product</span>
<span onclick="openTab('vendor',this)">Vendor</span>
<span onclick="openTab('settings',this)">Settings</span>
</nav>

<section id="invoice"></section>
<section id="purchase"></section>
<section id="product"></section>
<section id="vendor"></section>
<section id="settings"></section>

<script>
/* ---------------- DATABASE ---------------- */
let db = JSON.parse(localStorage.getItem("tpdb")) || {
  products: [],
  vendors: [],
  invoices: [],
  purchases: []
};
function saveDB(){localStorage.setItem("tpdb",JSON.stringify(db));}

/* ---------------- NAV ---------------- */
function openTab(id,el){
  document.querySelectorAll("nav span").forEach(x=>x.classList.remove("active"));
  el.classList.add("active");
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
  window["render_"+id]();
}
openTab("invoice",document.querySelector("nav span"));

/* ---------------- PRODUCT ---------------- */
function render_product(){
  let h=`<h3>Products</h3>
  <button onclick="productForm()">New Product</button>
  <table>
  <tr><th>#</th><th>Barcode</th><th>Item No</th><th>Description</th><th>Rate</th><th>Stock</th></tr>`;
  db.products.forEach((p,i)=>{
    h+=`<tr onclick="productForm(${i})">
      <td>${i+1}</td>
      <td>${p.barcode}</td>
      <td>${p.item}</td>
      <td>${p.desc}</td>
      <td>${p.rate}</td>
      <td>${p.stock}</td>
    </tr>`;
  });
  h+=`</table>`;
  product.innerHTML=h;
}

function productForm(i){
  let p=i!=null?db.products[i]:
    {barcode:"",item:"",desc:"",rate:0,stock:0};
  product.innerHTML=`
  <h3>${i!=null?"Edit":"New"} Product</h3>
  <div class="flex">
    <input placeholder="Barcode" id="pb" value="${p.barcode}">
    <input placeholder="Item No" id="pi" value="${p.item}">
  </div><br>
  <input placeholder="Description" id="pd" value="${p.desc}"><br><br>
  <div class="flex">
    <input type="number" placeholder="Retail Rate" id="pr" value="${p.rate}">
    <input type="number" placeholder="Opening Stock" id="ps" value="${p.stock}">
  </div><br>
  <button onclick="saveProduct(${i})">Save</button>
  <button class="secondary" onclick="render_product()">Back</button>`;
}

function saveProduct(i){
  let p={
    barcode:pb.value,
    item:pi.value,
    desc:pd.value,
    rate:+pr.value,
    stock:+ps.value
  };
  if(i!=null) db.products[i]=p;
  else db.products.push(p);
  saveDB(); render_product();
}

/* ---------------- VENDOR ---------------- */
function render_vendor(){
  let h=`<h3>Vendors</h3>
  <button onclick="vendorForm()">New Vendor</button>
  <table>
  <tr><th>#</th><th>Name</th><th>Balance</th><th>Last Purchase</th><th>Last Payment</th></tr>`;
  db.vendors.forEach((v,i)=>{
    h+=`<tr>
      <td>${i+1}</td>
      <td>${v.name}</td>
      <td>${v.balance||0}</td>
      <td>${v.lastPurchase||0}</td>
      <td>${v.lastPayment||0}</td>
    </tr>`;
  });
  h+=`</table>`;
  vendor.innerHTML=h;
}

function vendorForm(){
  vendor.innerHTML=`
  <h3>New Vendor</h3>
  <input placeholder="Vendor Name" id="vn"><br><br>
  <input type="number" placeholder="Opening Balance" id="vb"><br><br>
  <button onclick="saveVendor()">Save</button>
  <button class="secondary" onclick="render_vendor()">Back</button>`;
}

function saveVendor(){
  db.vendors.push({
    name:vn.value,
    balance:+vb.value,
    lastPurchase:0,
    lastPayment:0
  });
  saveDB(); render_vendor();
}

/* ---------------- SETTINGS ---------------- */
function render_settings(){
  settings.innerHTML=`
  <h3>Settings</h3>
  <p>Theme, tax, invoice config will be here.</p>`;
}

<script>
/* ---------------- INVOICE ---------------- */
let invoiceDraft=null;

function render_invoice(){
  if(!invoiceDraft){
    invoice.innerHTML=`<h3>Invoices</h3>
    <button onclick="newInvoice()">New Invoice</button>
    <table>
    <tr>
      <th>#</th><th>Date</th><th>Bill</th><th>Products</th>
      <th>Amount</th><th>Discount</th><th>Total</th><th>Time</th>
    </tr>`;
    db.invoices.forEach((i,x)=>{
      h=`<tr onclick="editInvoice(${x})">
      <td>${x+1}</td><td>${i.date}</td><td>${i.bill}</td>
      <td>${i.items.length}</td>
      <td>${i.amount}</td><td>${i.discount}</td>
      <td>${i.total}</td><td>${i.time}</td></tr>`;
      invoice.innerHTML+=h;
    });
    invoice.innerHTML+=`</table>`;
    return;
  }
  drawInvoiceEditor();
}

function newInvoice(){
  invoiceDraft={
    bill:"INV"+(db.invoices.length+1),
    items:[],
    discRs:0,
    discPc:0
  };
  drawInvoiceEditor();
}

function drawInvoiceEditor(){
  let h=`<h3>Invoice ${invoiceDraft.bill}</h3>
  <table id="invTable">
  <tr>
    <th>Barcode</th><th>Item No</th><th>Description</th>
    <th>Qty</th><th>Rate</th><th>Disc Rs</th><th>Disc %</th><th>Amount</th>
  </tr>`;
  invoiceDraft.items.forEach(drawRow);
  h+=drawRow();
  h+=`</table>

  <div class="total-box">
    <div>Amount <input id="iAmt" readonly></div>
    <div>Discount <input id="iDisc" readonly></div>
    <div>Total <input id="iTotal" readonly></div>
  </div>

  <button onclick="saveInvoice()">Save</button>
  <button class="secondary" onclick="invoiceDraft=null;render_invoice()">Back</button>`;
  invoice.innerHTML=h;
  calcInvoice();
}

function drawRow(r={}){
  return `<tr>
    <td><input value="${r.barcode||""}"></td>
    <td><input value="${r.item||""}"></td>
    <td><input value="${r.desc||""}"></td>
    <td><input type="number" value="${r.qty||1}" oninput="calcInvoice()"></td>
    <td><input type="number" value="${r.rate||0}" readonly></td>
    <td><input type="number" value="${r.discRs||0}" oninput="calcInvoice()"></td>
    <td><input type="number" value="${r.discPc||0}" oninput="calcInvoice()"></td>
    <td><input readonly></td>
  </tr>`;
}

function calcInvoice(){
  let amt=0,disc=0;
  document.querySelectorAll("#invTable tr").forEach((r,i)=>{
    if(i===0) return;
    let q=+r.cells[3].children[0].value||0;
    let rate=+r.cells[4].children[0].value||0;
    let d=+r.cells[5].children[0].value||0;
    let a=(q*rate)-d;
    r.cells[7].children[0].value=a>0?a:0;
    amt+=q*rate;
    disc+=d;
  });
  iAmt.value=amt;
  iDisc.value=disc;
  iTotal.value=amt-disc;
}

function saveInvoice(){
  let items=[];
  document.querySelectorAll("#invTable tr").forEach((r,i)=>{
    if(i===0) return;
    let d=r.cells[2].children[0].value;
    if(!d) return;
    items.push({
      desc:d,
      qty:+r.cells[3].children[0].value,
      rate:+r.cells[4].children[0].value
    });
  });
  let now=new Date();
  db.invoices.push({
    bill:invoiceDraft.bill,
    date:now.toLocaleDateString(),
    time:now.toLocaleTimeString(),
    items,
    amount:+iAmt.value,
    discount:+iDisc.value,
    total:+iTotal.value
  });
  saveDB();
  invoiceDraft=null;
  render_invoice();
}

/* ---------------- PURCHASE ---------------- */
function render_purchase(){
  purchase.innerHTML=`<h3>Purchases</h3>
  <button onclick="newPurchase()">New Purchase</button>`;
}

function newPurchase(){
  purchase.innerHTML=`<h3>New Purchase</h3>
  Vendor:
  <select id="pv">${db.vendors.map(v=>`<option>${v.name}</option>`)}</select>
  <table id="purTable">
  <tr>
    <th>Barcode</th><th>Item No</th><th>Description</th>
    <th>Qty</th><th>Rate</th><th>Amount</th>
  </tr>
  </table>
  <button onclick="savePurchase()">Save</button>
  <button class="secondary" onclick="render_purchase()">Back</button>`;
}

function savePurchase(){
  let total=0;
  document.querySelectorAll("#purTable tr").forEach((r,i)=>{
    if(i===0) return;
    let q=+r.cells[3].children[0].value||0;
    let rate=+r.cells[4].children[0].value||0;
    total+=q*rate;
  });
  saveDB();
  render_purchase();
}
</script>
