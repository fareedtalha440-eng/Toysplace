<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Toysplace Dani Test</title>

<style>
body{font-family:Arial;margin:0;background:#f5f5f5}
header{background:#222;color:#fff;padding:10px;text-align:center}
nav{background:#333;padding:10px;display:flex;gap:10px}
nav button{background:#555;color:#fff;border:0;padding:8px 12px;cursor:pointer}
nav button:hover{background:#777}
section{display:none;padding:15px}
.card{background:#fff;padding:15px;border-radius:6px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px}
input,select,button{padding:6px;margin:4px}
.green{background:#2ecc71;color:#fff;border:0}
.red{background:#e74c3c;color:#fff;border:0}
.secondary{background:#999;color:#fff;border:0}
</style>
</head>

<body>

<header>
<h2>Toysplace Dani Test</h2>
<div id="cashDisplay">Cash In Hand: 0</div>
</header>

<nav>
<button onclick="openSection('invoice')">Invoice</button>
<button onclick="openSection('purchase')">Purchase</button>
<button onclick="openSection('products')">Products</button>
<button onclick="openSection('vendors')">Vendors</button>
<button onclick="openSection('reports')">Reports</button>
</nav>

<!-- INVOICE -->
<section id="invoice">
<div class="card">
<h3>Invoice</h3>
<input id="invBarcode" placeholder="Scan / Search Barcode" onkeypress="scanBarcode(event)">
<table id="invTable">
<tr><th>Item</th><th>Qty</th><th>Rate</th><th>Total</th><th></th></tr>
</table>
<button class="green" onclick="saveInvoice()">Save Invoice</button>
<button onclick="printInvoice()">Print</button>
</div>
</section>

<!-- PURCHASE -->
<section id="purchase">
<div class="card">
<h3>Purchase</h3>
<select id="purVendor"></select><br>
<input id="purBarcode" placeholder="Barcode">
<input id="purQty" type="number" placeholder="Qty">
<input id="purCost" type="number" placeholder="Cost">
<button onclick="addPurchase()">Add Purchase</button>
</div>
</section>

<!-- PRODUCTS -->
<section id="products">
<div class="card">
<h3>Products</h3>
<button class="secondary" onclick="openProduct()">Add Product</button>
<table id="prodTable">
<tr><th>Barcode</th><th>Item</th><th>Rate</th><th>Stock</th></tr>
</table>
</div>
</section>

<!-- VENDORS -->
<section id="vendors">
<div class="card">
<h3>Vendors</h3>
<input id="vendorName" placeholder="Vendor Name">
<button onclick="addVendor()">Add Vendor</button>

<table id="vendorTable">
<tr><th>Name</th><th>Balance</th></tr>
</table>

<div id="ledger"></div>
</div>
</section>

<!-- REPORTS -->
<section id="reports">
<div class="card">
<h3>Reports</h3>
<div id="repSales"></div>
<div id="repPurchase"></div>
</div>
</section>

<!-- PRODUCT MODAL -->
<div id="prodModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#0006">
<div style="background:#fff;width:300px;margin:80px auto;padding:15px">
<input id="pBarcode" placeholder="Barcode">
<input id="pItem" placeholder="Item No">
<input id="pRate" type="number" placeholder="Rate"><br>
<button onclick="saveProduct()">Save</button>
<button onclick="closeProduct()">Cancel</button>
</div>
</div>

<script>
let DB={
products:[],
vendors:[],
invoices:[],
purchases:[],
cash:0
};

function saveDB(){localStorage.setItem("DB",JSON.stringify(DB))}
function loadDB(){
let d=localStorage.getItem("DB");
if(d) DB=JSON.parse(d);
}
loadDB();

function uid(p){return p+Math.random().toString(36).substr(2,9)}

function openSection(id){
document.querySelectorAll("section").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
renderAll();
}

function renderAll(){
renderProducts();
renderVendors();
renderReports();
renderCash();
}

function renderCash(){
document.getElementById("cashDisplay").innerText="Cash In Hand: "+DB.cash;
}

/* INVOICE */
let invoiceDraft=[];

function scanBarcode(e){
if(e.key==="Enter"){
let p=DB.products.find(x=>x.barcode===e.target.value);
if(!p || p.stock<=0){alert("Product not found or out of stock");return;}
invoiceDraft.push({pid:p.id,qty:1,rate:p.rate});
p.stock--;
renderInvoice();
e.target.value="";
}
}

function renderInvoice(){
let t=document.getElementById("invTable");
t.innerHTML="<tr><th>Item</th><th>Qty</th><th>Rate</th><th>Total</th><th></th></tr>";
invoiceDraft.forEach((r,i)=>{
let p=DB.products.find(x=>x.id===r.pid);
t.innerHTML+=`
<tr>
<td>${p.item}</td>
<td>${r.qty}</td>
<td>${r.rate}</td>
<td>${r.qty*r.rate}</td>
<td><button class="red" onclick="removeInv(${i})">X</button></td>
</tr>`;
});
}

function removeInv(i){invoiceDraft.splice(i,1);renderInvoice()}

function saveInvoice(){
let total=invoiceDraft.reduce((a,b)=>a+b.qty*b.rate,0);
DB.invoices.push({items:invoiceDraft,total});
DB.cash+=total;
invoiceDraft=[];
saveDB();
renderInvoice();
renderCash();
}

function printInvoice(){
let w=window.open("");
w.document.write("<h3>Invoice</h3>");
DB.invoices.at(-1)?.items.forEach(r=>{
let p=DB.products.find(x=>x.id===r.pid);
w.document.write(`${p.item} - ${r.qty} x ${r.rate}<br>`);
});
w.print();
}

/* PRODUCTS */
function openProduct(){prodModal.style.display="block"}
function closeProduct(){prodModal.style.display="none"}

function saveProduct(){
DB.products.push({
id:uid("P"),
barcode:pBarcode.value,
item:pItem.value,
rate:+pRate.value,
stock:0
});
saveDB();
closeProduct();
renderProducts();
}

function renderProducts(){
let t=document.getElementById("prodTable");
t.innerHTML="<tr><th>Barcode</th><th>Item</th><th>Rate</th><th>Stock</th></tr>";
DB.products.forEach(p=>{
t.innerHTML+=`<tr><td>${p.barcode}</td><td>${p.item}</td><td>${p.rate}</td><td>${p.stock}</td></tr>`;
});
}

/* VENDORS */
function addVendor(){
DB.vendors.push({id:uid("V"),name:vendorName.value,bal:0,ledger:[]});
saveDB();
renderVendors();
}

function renderVendors(){
let t=document.getElementById("vendorTable");
t.innerHTML="<tr><th>Name</th><th>Balance</th></tr>";

DB.vendors.forEach(v=>{
t.innerHTML+=`<tr onclick="showLedger('${v.id}')"><td>${v.name}</td><td>${v.bal}</td></tr>`;
});

let pv=document.getElementById("purVendor");
pv.innerHTML="";
DB.vendors.forEach(v=>{
pv.innerHTML+=`<option value="${v.id}">${v.name}</option>`;
});
}

function showLedger(id){
let v=DB.vendors.find(x=>x.id===id);
ledger.innerHTML="<h4>Ledger</h4>"+v.ledger.join("<br>");
}

/* PURCHASE */
function addPurchase(){
let v=DB.vendors.find(x=>x.id===purVendor.value);
let p=DB.products.find(x=>x.barcode===purBarcode.value);
if(!p){alert("Product not found");return;}
let amt=+purQty.value * +purCost.value;
p.stock+=+purQty.value;
v.bal+=amt;
v.ledger.push("Purchase: "+amt);
DB.purchases.push({amt});
saveDB();
renderAll();
}

/* REPORTS */
function renderReports(){
repSales.innerText="Total Sales: "+DB.invoices.reduce((a,b)=>a+b.total,0);
repPurchase.innerText="Total Purchases: "+DB.purchases.reduce((a,b)=>a+b.amt,0);
}

openSection("invoice");
</script>

</body>
</html>
